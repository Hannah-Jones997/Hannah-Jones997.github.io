{"version":3,"file":"header-menu.js","sources":["../../../src/components/ui-shell/header-menu.ts"],"sourcesContent":["/**\n * Copyright IBM Corp. 2019, 2024\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { ifDefined } from 'lit/directives/if-defined.js';\nimport { LitElement, html } from 'lit';\nimport { property, query } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport ChevronDownGlyph from '@carbon/icons/lib/chevron--down/16.js';\nimport { prefix } from '../../globals/settings';\nimport FocusMixin from '../../globals/mixins/focus';\nimport HostListenerMixin from '../../globals/mixins/host-listener';\nimport HostListener from '../../globals/decorators/host-listener';\nimport { forEach } from '../../globals/internal/collection-helpers';\nimport CDSHeaderMenuItem from './header-menu-item';\nimport styles from './header.scss?lit';\nimport { carbonElement as customElement } from '../../globals/decorators/carbon-element';\n\n/**\n * Header menu.\n *\n * @element cds-custom-header-menu\n * @csspart trigger The trigger button.\n * @csspart trigger-icon The trigger button icon.\n * @csspart menu-body The menu body.\n */\n@customElement(`${prefix}-header-menu`)\nclass CDSHeaderMenu extends HostListenerMixin(FocusMixin(LitElement)) {\n  /**\n   * The trigger button.\n   */\n  @query('[part=\"trigger\"]')\n  protected _topMenuItem!: HTMLElement;\n\n  /**\n   * keeps track if header menu has any active submenus\n   */\n  private _hasActiveChildren = false;\n\n  /**\n   * Handles `click` event handler on this element.\n   */\n  private _handleClick() {\n    this._handleUserInitiatedToggle();\n  }\n\n  /**\n   * Handler for the `keydown` event on the trigger button.\n   */\n  @HostListener('keydown')\n  // @ts-ignore: The decorator refers to this method but TS thinks this method is not referred to\n  private _handleKeydownTrigger({ key }: KeyboardEvent) {\n    if (key === 'Esc' || key === 'Escape') {\n      this._handleUserInitiatedToggle(false);\n    }\n  }\n\n  /**\n   * Handles user-initiated toggling the open state.\n   *\n   * @param [force] If specified, forces the open state to the given one.\n   */\n  private _handleUserInitiatedToggle(force = !this.expanded) {\n    this.expanded = force;\n    if (!force) {\n      this._topMenuItem.focus();\n    }\n  }\n\n  /**\n   * Handles `blur` event handler on this element.\n   */\n  @HostListener('focusout')\n  // @ts-ignore: The decorator refers to this method but TS thinks this method is not referred to\n  private _handleBlur({ relatedTarget }: FocusEvent) {\n    if (!this.contains(relatedTarget as Node)) {\n      this.expanded = false;\n    }\n  }\n\n  /**\n   * `true` if the menu should be expanded.\n   */\n  @property({ type: Boolean, reflect: true })\n  expanded = false;\n\n  /**\n   * Applies selected styles to the item if a user sets this to true and `aria-current !== 'page'`.\n   */\n  @property({ type: Boolean, attribute: 'is-active', reflect: true })\n  isActive = false;\n\n  /**\n   * The content of the trigger button.\n   */\n  @property({ attribute: 'trigger-content' })\n  triggerContent = '';\n\n  /**\n   * The `aria-label` attribute for the menu UI.\n   */\n  @property({ attribute: 'menu-label' })\n  menuLabel!: string;\n\n  connectedCallback() {\n    if (!this.hasAttribute('role')) {\n      this.setAttribute('role', 'listitem');\n    }\n    const { selectorItem } = this.constructor as typeof CDSHeaderMenu;\n    forEach(this.querySelectorAll(selectorItem), (elem) => {\n      if ((elem as CDSHeaderMenuItem).isActive === true) {\n        this._hasActiveChildren = true;\n      }\n    });\n\n    super.connectedCallback();\n  }\n\n  updated(changedProperties) {\n    if (changedProperties.has('expanded')) {\n      const { selectorItem } = this.constructor as typeof CDSHeaderMenu;\n      const { expanded } = this;\n      forEach(this.querySelectorAll(selectorItem), (elem) => {\n        (elem as HTMLElement).tabIndex = expanded ? 0 : -1;\n      });\n    }\n  }\n\n  render() {\n    const {\n      expanded,\n      isActive,\n      triggerContent,\n      menuLabel,\n      _hasActiveChildren,\n      _handleClick: handleClick,\n    } = this;\n\n    const linkClasses = classMap({\n      [`${prefix}--header__menu-item`]: true,\n      [`${prefix}--header__menu-title`]: true,\n      [`${prefix}--header__menu-item--current`]:\n        isActive || (_hasActiveChildren && !expanded),\n    });\n\n    return html`\n      <a\n        part=\"trigger\"\n        role=\"button\"\n        tabindex=\"0\"\n        class=\"${linkClasses}\"\n        href=\"javascript:void 0\"\n        aria-haspopup=\"menu\"\n        aria-expanded=\"${String(Boolean(expanded))}\"\n        @click=${handleClick}>\n        ${triggerContent}${ChevronDownGlyph({\n          part: 'trigger-icon',\n          class: `${prefix}--header__menu-arrow`,\n        })}\n      </a>\n      <ul\n        part=\"menu-body\"\n        class=\"${prefix}--header__menu\"\n        aria-label=\"${ifDefined(menuLabel)}\">\n        <slot></slot>\n      </ul>\n    `;\n  }\n\n  /**\n   * A selector that will return the menu items.\n   */\n  static get selectorItem() {\n    return `${prefix}-header-menu-item`;\n  }\n\n  static shadowRootOptions = {\n    ...LitElement.shadowRootOptions,\n    delegatesFocus: true,\n  };\n  static styles = styles;\n}\n\nexport default CDSHeaderMenu;\n"],"names":["ChevronDownGlyph","customElement"],"mappings":"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"}