{"version":3,"file":"index.js","sources":["../../../src/components/feature-flags/index.ts"],"sourcesContent":["/**\n * Copyright IBM Corp. 2025, 2025\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n/**\n * <feature-flags> provides scoped feature flags to child components.\n *\n * Usage:\n * Wrap any child components inside <feature-flags> to provide scoped feature flags like this:\n * <feature-flags enable-dialog-element=\"true\">\n *   <component></component>\n * </feature-flags>\n *\n * Available flags:\n * - enable-dialog-element\n * - enable-treeview-controllable\n * - ... (and others listed in observedAttributes)\n *\n * How to check a Flag in your component:\n *   import { isFeatureFlagEnabled } from './feature-flags';\n *   isFeatureFlagEnabled('enable-dialog-element', this)\n *   Returns true if the flag is enabled in the nearest <feature-flags> ancestor\n */\n\nimport {\n  FeatureFlags as GlobalFeatureFlags,\n  createScope,\n} from '@carbon/feature-flags';\nimport { carbonElement as customElement } from '../../globals/decorators/carbon-element';\nimport { LitElement, html } from 'lit';\n\n/**\n * Feature Flgs\n *\n * @element feature-flags\n */\n\ntype FeatureFlags = Record<string, boolean>;\n\n@customElement('feature-flags')\nclass FeatureFlagsElement extends LitElement {\n  private scope = GlobalFeatureFlags;\n  private flags: FeatureFlags = {};\n\n  static get observedAttributes() {\n    return [\n      'enable-v12-tile-default-icons',\n      'enable-v12-tile-radio-icons',\n      'enable-v12-overflowmenu',\n      'enable-treeview-controllable',\n      'enable-experimental-focus-wrap-without-sentinels',\n      'enable-dialog-element',\n      'enable-v12-dynamic-floating-styles',\n    ];\n  }\n\n  constructor() {\n    super();\n    this.attachShadow({ mode: 'open' });\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this.updateScope();\n  }\n\n  attributeChangedCallback(\n    name: string,\n    _oldVal: string | null,\n    newVal: string | null\n  ) {\n    const value = newVal === 'true';\n    this.flags[name] = value;\n    this.updateScope();\n  }\n\n  private getParentScope(): FeatureFlagsElement | null {\n    let parent = this.parentNode;\n    while (parent) {\n      if (parent instanceof FeatureFlagsElement) {\n        return parent.getScope();\n      }\n      parent = parent.parentNode;\n    }\n    return null;\n  }\n\n  private updateScope() {\n    const newScope = createScope(this.flags);\n    const parentScope = this.getParentScope() || GlobalFeatureFlags;\n    if (parentScope) {\n      newScope.mergeWithScope(parentScope);\n    }\n    this.scope = newScope;\n  }\n\n  render() {\n    return html` <slot></slot> `;\n  }\n\n  public isFeatureFlagEnabled(flag: string): boolean {\n    return this.scope.enabled(flag);\n  }\n\n  private getScope() {\n    return this.scope;\n  }\n}\n\nexport default FeatureFlagsElement;\n\n// Utility functions\n\n// Function to find the nearest parent FeatureFlagsElement\nexport function findParentFeatureFlags(\n  el: HTMLElement\n): FeatureFlagsElement | null {\n  let parent = el.parentNode;\n  while (parent) {\n    if (parent instanceof FeatureFlagsElement) {\n      return parent;\n    }\n    parent = (parent as HTMLElement).parentNode;\n  }\n  return null;\n}\n\n// function to check if a feature flag is enabled in components\nexport function isFeatureFlagEnabled(\n  flag: string,\n  context: HTMLElement\n): boolean {\n  const instance = findParentFeatureFlags(context);\n  return instance?.isFeatureFlagEnabled(flag) ?? false;\n}\n"],"names":["GlobalFeatureFlags","customElement"],"mappings":";;;;;;;;;;;;AAAA;;;;;AAKG;AACH;;;;;;;;;;;;;;;;;;AAkBG;;AAkBH,IAAM,mBAAmB,GAAA,qBAAA,GAAzB,MAAM,mBAAoB,SAAQ,UAAU,CAAA;AAI1C,IAAA,WAAW,kBAAkB,GAAA;QAC3B,OAAO;YACL,+BAA+B;YAC/B,6BAA6B;YAC7B,yBAAyB;YACzB,8BAA8B;YAC9B,kDAAkD;YAClD,uBAAuB;YACvB,oCAAoC;SACrC;;AAGH,IAAA,WAAA,GAAA;AACE,QAAA,KAAK,EAAE;QAhBD,IAAK,CAAA,KAAA,GAAGA,YAAkB;QAC1B,IAAK,CAAA,KAAA,GAAiB,EAAE;QAgB9B,IAAI,CAAC,YAAY,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;;IAGrC,iBAAiB,GAAA;QACf,KAAK,CAAC,iBAAiB,EAAE;QACzB,IAAI,CAAC,WAAW,EAAE;;AAGpB,IAAA,wBAAwB,CACtB,IAAY,EACZ,OAAsB,EACtB,MAAqB,EAAA;AAErB,QAAA,MAAM,KAAK,GAAG,MAAM,KAAK,MAAM;AAC/B,QAAA,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,KAAK;QACxB,IAAI,CAAC,WAAW,EAAE;;IAGZ,cAAc,GAAA;AACpB,QAAA,IAAI,MAAM,GAAG,IAAI,CAAC,UAAU;QAC5B,OAAO,MAAM,EAAE;AACb,YAAA,IAAI,MAAM,YAAY,qBAAmB,EAAE;AACzC,gBAAA,OAAO,MAAM,CAAC,QAAQ,EAAE;;AAE1B,YAAA,MAAM,GAAG,MAAM,CAAC,UAAU;;AAE5B,QAAA,OAAO,IAAI;;IAGL,WAAW,GAAA;QACjB,MAAM,QAAQ,GAAG,WAAW,CAAC,IAAI,CAAC,KAAK,CAAC;QACxC,MAAM,WAAW,GAAG,IAAI,CAAC,cAAc,EAAE,IAAIA,YAAkB;QAC/D,IAAI,WAAW,EAAE;AACf,YAAA,QAAQ,CAAC,cAAc,CAAC,WAAW,CAAC;;AAEtC,QAAA,IAAI,CAAC,KAAK,GAAG,QAAQ;;IAGvB,MAAM,GAAA;QACJ,OAAO,IAAI,CAAA,CAAA,eAAA,CAAiB;;AAGvB,IAAA,oBAAoB,CAAC,IAAY,EAAA;QACtC,OAAO,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC;;IAGzB,QAAQ,GAAA;QACd,OAAO,IAAI,CAAC,KAAK;;CAEpB;AAnEK,mBAAmB,GAAA,qBAAA,GAAA,UAAA,CAAA;IADxBC,aAAa,CAAC,eAAe;AACxB,CAAA,EAAA,mBAAmB,CAmExB;AAED,4BAAe,mBAAmB;AAElC;AAEA;AACM,SAAU,sBAAsB,CACpC,EAAe,EAAA;AAEf,IAAA,IAAI,MAAM,GAAG,EAAE,CAAC,UAAU;IAC1B,OAAO,MAAM,EAAE;AACb,QAAA,IAAI,MAAM,YAAY,mBAAmB,EAAE;AACzC,YAAA,OAAO,MAAM;;AAEf,QAAA,MAAM,GAAI,MAAsB,CAAC,UAAU;;AAE7C,IAAA,OAAO,IAAI;AACb;AAEA;AACgB,SAAA,oBAAoB,CAClC,IAAY,EACZ,OAAoB,EAAA;;AAEpB,IAAA,MAAM,QAAQ,GAAG,sBAAsB,CAAC,OAAO,CAAC;AAChD,IAAA,OAAO,CAAA,EAAA,GAAA,QAAQ,KAAR,IAAA,IAAA,QAAQ,KAAR,MAAA,GAAA,MAAA,GAAA,QAAQ,CAAE,oBAAoB,CAAC,IAAI,CAAC,MAAA,IAAA,IAAA,EAAA,KAAA,MAAA,GAAA,EAAA,GAAI,KAAK;AACtD;;;;"}