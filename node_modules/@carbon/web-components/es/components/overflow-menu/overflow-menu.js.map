{"version":3,"file":"overflow-menu.js","sources":["../../../src/components/overflow-menu/overflow-menu.ts"],"sourcesContent":["/**\n * Copyright IBM Corp. 2019, 2023\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { html } from 'lit';\nimport { property } from 'lit/decorators.js';\nimport { prefix } from '../../globals/settings';\nimport HostListener from '../../globals/decorators/host-listener';\nimport FocusMixin from '../../globals/mixins/focus';\nimport HostListenerMixin from '../../globals/mixins/host-listener';\nimport { find } from '../../globals/internal/collection-helpers';\nimport CDSFloatingMenuTrigger from '../floating-menu/floating-menu-trigger';\nimport { OVERFLOW_MENU_SIZE } from './defs';\nimport CDSOverflowMenuBody from './overflow-menu-body';\nimport styles from './overflow-menu.scss?lit';\nimport CDSIconButton from '../icon-button/icon-button';\nimport { carbonElement as customElement } from '../../globals/decorators/carbon-element';\n\nexport { OVERFLOW_MENU_SIZE };\n\n/**\n * Overflow menu.\n *\n * @element cds-overflow-menu\n * @slot icon - The icon for the trigger button.\n */\n@customElement(`${prefix}-overflow-menu`)\nclass CDSOverflowMenu\n  extends HostListenerMixin(FocusMixin(CDSIconButton))\n  implements CDSFloatingMenuTrigger\n{\n  /**\n   * The menu body.\n   */\n  private _menuBody: CDSOverflowMenuBody | null = null;\n\n  /**\n   * Handles user-initiated toggling of the menu.\n   */\n  private async _handleUserInitiatedToggle() {\n    this.open = !this.open;\n    const { index, open, updateComplete } = this;\n    if (open) {\n      await updateComplete;\n      const { _menuBody: menuBody } = this;\n      const menuItem = menuBody?.querySelector(\n        `${prefix}-overflow-menu-item:nth-of-type(${index})`\n      ) as HTMLElement;\n      menuItem?.focus();\n    }\n  }\n\n  /**\n   * Handles `click` event on the trigger button.\n   */\n  @HostListener('click')\n  // @ts-ignore: The decorator refers to this method but TS thinks this method is not referred to\n  private _handleClickTrigger = async () => {\n    this._handleUserInitiatedToggle();\n  };\n\n  /**\n   * Handles `keydown` event on the trigger button.\n   */\n  @HostListener('keydown')\n  // @ts-ignore: The decorator refers to this method but TS thinks this method is not referred to\n  private _handleKeydownTrigger = async (event) => {\n    if (event.key === ' ' || event.key === 'Enter') {\n      this._handleUserInitiatedToggle();\n      event.preventDefault();\n    }\n  };\n\n  /**\n   * `true` if this tooltip is in a data table row\n   */\n  @property({ type: Boolean, reflect: true, attribute: 'data-table' })\n  dataTable = false;\n\n  /**\n   * `true` if this overflow menu should be disabled.\n   */\n  @property({ type: Boolean, reflect: true })\n  disabled = false;\n\n  /**\n   * `true` if this overflow menu body should be flipped.\n   */\n  @property({ type: Boolean, reflect: true })\n  flipped = false;\n\n  /**\n   * `true` if the dropdown should be open.\n   */\n  @property({ type: Boolean, reflect: true })\n  open = false;\n\n  /**\n   * Index (starting at 1) of overflow menu item to focus on open.\n   */\n  @property()\n  index = 1;\n\n  /**\n   * Overflow menu size.\n   */\n  @property({ reflect: true })\n  size = OVERFLOW_MENU_SIZE.MEDIUM;\n\n  /**\n   * `true` if this menu is a toolbar action\n   */\n  @property({ type: Boolean, attribute: 'toolbar-action', reflect: true })\n  toolbarAction = false;\n\n  /**\n   * `true` if this overflow menu use inside breadcrumb.\n   */\n  @property({ type: Boolean, reflect: true })\n  breadcrumb = false;\n\n  /**\n   * @returns The position of the trigger button in the viewport.\n   */\n  get triggerPosition() {\n    return this.getBoundingClientRect();\n  }\n\n  connectedCallback() {\n    if (!this.hasAttribute('aria-haspopup')) {\n      this.setAttribute('aria-haspopup', 'true');\n    }\n    if (!this.shadowRoot) {\n      this.attachShadow({ mode: 'open' });\n    }\n    super.connectedCallback();\n  }\n\n  updated(changedProperties) {\n    const button = this.shadowRoot\n      ?.querySelector(`${prefix}-tooltip`)\n      ?.querySelector('button');\n    button?.classList.add(\n      `${prefix}--btn--icon-only`,\n      `${prefix}--overflow-menu`\n    );\n\n    if (changedProperties.has('open')) {\n      const { open } = this;\n      if (open && !this._menuBody) {\n        this._menuBody = find(\n          this.childNodes,\n          (elem) =>\n            (elem.constructor as typeof CDSOverflowMenuBody).FLOATING_MENU\n        );\n      }\n      const { _menuBody: menuBody } = this;\n      if (menuBody) {\n        menuBody.setAttribute('breadcrumb', String(Boolean(this.breadcrumb)));\n        menuBody.open = open;\n\n        const tooltipContent = this.querySelector(\n          '[slot=tooltip-content]'\n        )?.textContent;\n        button?.setAttribute('aria-expanded', String(Boolean(open)));\n        button?.setAttribute('aria-label', String(tooltipContent));\n      }\n    }\n\n    if (changedProperties.has('dataTable')) {\n      const tooltip = this.shadowRoot?.querySelector(`${prefix}-tooltip`);\n      tooltip?.setAttribute('data-table', '');\n    }\n\n    if (changedProperties.has('size')) {\n      const { size } = this;\n      const { _menuBody: menuBody } = this;\n      if (menuBody) {\n        menuBody.size = size;\n      }\n\n      button?.classList.forEach((item) => {\n        if (item.startsWith(`${prefix}--overflow-menu--`)) {\n          button?.classList.remove(item);\n        }\n      });\n      button?.classList.add(`${prefix}--overflow-menu--${this.size}`);\n\n      const tooltip = this.shadowRoot?.querySelector(`${prefix}-tooltip`);\n      tooltip?.setAttribute('size', this.size);\n    }\n\n    if (changedProperties.has('toolbarAction') && this.toolbarAction) {\n      this.shadowRoot\n        ?.querySelector(`${prefix}-tooltip`)\n        ?.setAttribute('toolbar-action', '');\n    }\n\n    super.updated(changedProperties);\n  }\n\n  render() {\n    return html`${super.render()} `;\n  }\n\n  static styles = styles;\n}\n\nexport default CDSOverflowMenu;\n"],"names":["customElement"],"mappings":"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"}