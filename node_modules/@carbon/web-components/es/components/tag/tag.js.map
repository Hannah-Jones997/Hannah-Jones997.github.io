{"version":3,"file":"tag.js","sources":["../../../src/components/tag/tag.ts"],"sourcesContent":["/**\n * Copyright IBM Corp. 2019, 2023\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { LitElement, html } from 'lit';\nimport { property, query, state } from 'lit/decorators.js';\nimport Close16 from '@carbon/icons/lib/close/16.js';\nimport { prefix } from '../../globals/settings';\nimport FocusMixin from '../../globals/mixins/focus';\nimport HostListener from '../../globals/decorators/host-listener';\nimport HostListenerMixin from '../../globals/mixins/host-listener';\nimport { TAG_SIZE, TAG_TYPE } from './defs';\nimport styles from './tag.scss?lit';\nimport { carbonElement as customElement } from '../../globals/decorators/carbon-element';\n\nexport { TAG_SIZE, TAG_TYPE };\n\n/**\n * Tag.\n * @element cds-tag\n * @fires cds-tag-beingclosed - The custom event fired as the element is being closed\n * @fires cds-tag-closed - The custom event fired after the element has been closed\n */\n@customElement(`${prefix}-tag`)\nclass CDSTag extends HostListenerMixin(FocusMixin(LitElement)) {\n  @query('button')\n  protected _buttonNode!: HTMLButtonElement;\n\n  /**\n   * Handles `slotchange` event.\n   */\n  protected _handleAILabelSlotChange({ target }: Event) {\n    const hasContent = (target as HTMLSlotElement)\n      .assignedNodes()\n      .filter((elem) =>\n        (elem as HTMLElement).matches !== undefined\n          ? (elem as HTMLElement).matches(\n              (this.constructor as typeof CDSTag).aiLabelItem\n            ) ||\n            // remove reference of slug in v12\n            (elem as HTMLElement).matches(\n              (this.constructor as typeof CDSTag).slugItem\n            )\n          : false\n      );\n    if (hasContent.length > 0) {\n      (hasContent[0] as HTMLElement).setAttribute('tag', `${this.type}`);\n      (hasContent[0] as HTMLElement).setAttribute('size', 'sm');\n      (hasContent[0] as HTMLElement).setAttribute('kind', 'inline');\n    }\n    this.requestUpdate();\n  }\n\n  /**\n   * Handles `slotchange` event.\n   */\n  protected _handleIconSlotChange({ target }: Event) {\n    const hasIcon = (target as HTMLSlotElement).assignedNodes();\n\n    this.hasCustomIcon = Boolean(hasIcon.length > 0);\n    this.requestUpdate();\n  }\n\n  /**\n   * Handles `click` event on this element.\n   *\n   * @param event The event.\n   */\n  @HostListener('shadowRoot:click')\n  // @ts-ignore: The decorator refers to this method but TS thinks this method is not referred to\n  protected _handleClick = (event: MouseEvent) => {\n    if (event.composedPath().indexOf(this._buttonNode!) >= 0) {\n      if (this.disabled) {\n        event.stopPropagation();\n      } else if (this.open) {\n        const init = {\n          bubbles: true,\n          cancelable: true,\n          composed: true,\n          detail: {\n            triggeredBy: event.target,\n          },\n        };\n        if (\n          this.dispatchEvent(\n            new CustomEvent(\n              (this.constructor as typeof CDSTag).eventBeforeClose,\n              init\n            )\n          )\n        ) {\n          this.open = false;\n          this.dispatchEvent(\n            new CustomEvent(\n              (this.constructor as typeof CDSTag).eventClose,\n              init\n            )\n          );\n        }\n      }\n    }\n  };\n\n  /**\n   * Text to show on filter tag \"clear\" buttons. Corresponds to the attribute with the same name\n   *\n   * @deprecated The `title` property has been deprecated and will be removed in the next major version. Use cds-dismissible-tag instead.\n   */\n  @property({ type: String })\n  title = 'Clear filter';\n\n  /**\n   * `true` if the tag should be disabled\n   */\n  @property({ type: Boolean, reflect: true })\n  disabled = false;\n\n  /**\n   * Determine if is a filter/chip\n   *\n   * @deprecated The `filter` property has been deprecated and will be removed in the next major version. Use cds-dismissible-tag instead.\n   */\n  @property({ type: Boolean, reflect: true })\n  filter = false;\n\n  /**\n   * `true` if there is a custom icon.\n   */\n  @property({ type: Boolean, attribute: 'has-custom-icon', reflect: true })\n  hasCustomIcon = false;\n\n  /**\n   * `true` if the tag should be open.\n   */\n  @property({ type: Boolean, reflect: true })\n  open = true;\n\n  /**\n   * The size of the tag.\n   */\n  @property({ reflect: true })\n  size = TAG_SIZE.MEDIUM;\n\n  /**\n   * The type of the tag.\n   */\n  @property({ reflect: true })\n  type = TAG_TYPE.GRAY;\n\n  /**\n   * true if the tag text has ellipsis applied\n   */\n  @state()\n  _hasEllipsisApplied = false;\n\n  updated() {\n    const textContainer = this.shadowRoot?.querySelector(\n      `.${prefix}--tag__label`\n    );\n    if (!textContainer || this._hasEllipsisApplied === true) return;\n\n    this._hasEllipsisApplied =\n      textContainer.scrollWidth > textContainer.clientWidth;\n\n    const root = this.getRootNode();\n    // Check if the root is a shadow root and get its host\n    if (root instanceof ShadowRoot) {\n      const parent = root.host.tagName.toLowerCase();\n      if (\n        parent === `${prefix}-selectable-tag` ||\n        parent === `${prefix}-operational-tag`\n      ) {\n        this.setAttribute('role', 'button');\n        this.tabIndex = this.disabled ? -1 : 0;\n      }\n    }\n  }\n\n  render() {\n    const {\n      disabled,\n      filter,\n      _handleAILabelSlotChange: handleAILabelSlotChange,\n      _handleIconSlotChange: handleIconSlotChange,\n      size,\n      title,\n    } = this;\n\n    return html`\n      ${size !== TAG_SIZE.SMALL\n        ? html`<slot name=\"icon\" @slotchange=\"${handleIconSlotChange}\"></slot>`\n        : ''}\n      <span class=\"${prefix}--tag__label\">\n        <slot></slot>\n      </span>\n      <slot name=\"decorator\" @slotchange=\"${handleAILabelSlotChange}\"></slot>\n      <slot name=\"ai-label\" @slotchange=\"${handleAILabelSlotChange}\"></slot>\n      <slot name=\"slug\" @slotchange=\"${handleAILabelSlotChange}\"></slot>\n      ${filter\n        ? html`\n            <button class=\"${prefix}--tag__close-icon\" ?disabled=${disabled}>\n              ${Close16({ 'aria-label': title })}\n            </button>\n          `\n        : ``}\n    `;\n  }\n\n  /**\n   * A selector that will return the slug item.\n   *\n   * remove in v12\n   */\n  static get slugItem() {\n    return `${prefix}-slug`;\n  }\n\n  /**\n   * A selector that will return the AI Label item.\n   */\n  static get aiLabelItem() {\n    return `${prefix}-ai-label`;\n  }\n\n  /**\n   * The name of the custom event fired before this tag is being closed upon a user gesture.\n   * Cancellation of this event stops the user-initiated action of closing this tag.\n   */\n  static get eventBeforeClose() {\n    return `${prefix}-tag-beingclosed`;\n  }\n\n  /**\n   * The name of the custom event fired after this tag is closed upon a user gesture.\n   */\n  static get eventClose() {\n    return `${prefix}-tag-closed`;\n  }\n\n  static styles = styles;\n}\n\nexport default CDSTag;\n"],"names":["customElement"],"mappings":"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"}