{"version":3,"file":"demo-file-uploader.js","sources":["../../../src/components/file-uploader/demo-file-uploader.ts"],"sourcesContent":["/**\n * Copyright IBM Corp. 2019, 2024\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { html, LitElement } from 'lit';\nimport { property } from 'lit/decorators.js';\nimport { carbonElement as customElement } from '../../globals/decorators/carbon-element';\n\nimport { prefix } from '../../globals/settings';\nimport { ifDefined } from 'lit/directives/if-defined.js';\nimport './index';\nimport { FILE_UPLOADER_ITEM_STATE } from './file-uploader-item';\nimport { BUTTON_SIZE } from '../button/button';\nimport { FileData } from './stories/types';\n\n/**\n * A class to manage file uploading states, like sending file contents to server.\n * DEMONSTRATION-PURPOSE ONLY.\n * Data/state handling in file uploading tends to involve lots of application-specific logics\n * and thus abstracting everything in a library won't be a good return on investment\n * vs. letting users copy code here and implement features that fit their needs.\n */\n@customElement(`${prefix}-ce-demo-file-uploader`)\nexport default class CDSCEDemoFileUploader extends LitElement {\n  /**\n   * The files being uploaded.\n   */\n  private _files: FileData[] = [];\n\n  /**\n   * Handles `cds-drop-container-changed` on `<cds-file-drop-container>`.\n   *\n   * @param event The event.\n   */\n  private _handleChange(event: CustomEvent) {\n    const { addedFiles } = event.detail;\n    const newFiles: FileData[] = addedFiles.map(\n      (item) =>\n        ({\n          id: Math.random().toString(36).slice(2),\n          file: item,\n          state: FILE_UPLOADER_ITEM_STATE.UPLOADING,\n        }) as FileData\n    );\n    const { multiple, _files: files, _simulateUpload: simulateUpload } = this;\n    if (multiple) {\n      this._files = files.concat(newFiles);\n      this.requestUpdate();\n      newFiles.forEach(simulateUpload, this);\n    } else if (addedFiles.length > 0) {\n      this._files = files.concat(newFiles[0]);\n      this.requestUpdate();\n      this._simulateUpload(newFiles[0]);\n    }\n  }\n\n  /**\n   * Handles `cds-file-uploader-item-deleted` on `<cds-file-uploader-item>`.\n   *\n   * @param event The event.\n   */\n  private _handleDelete(event: CustomEvent) {\n    const { fileId: idToDelete } = (event.target as HTMLElement).dataset;\n    this._files = this._files.filter(({ id }) => idToDelete !== id);\n    this.requestUpdate();\n  }\n\n  /**\n   * Simulates updating file.\n   *\n   * @param data The data of the file being uploaded.\n   */\n  private async _simulateUpload(data: FileData) {\n    const { id, file } = data;\n    if (file.size > 524288) {\n      this._files = this._files.map((item) =>\n        id !== item.id\n          ? item\n          : {\n              ...item,\n              state: FILE_UPLOADER_ITEM_STATE.EDIT,\n              invalid: true,\n              errorSubject: 'File size exceeds limit',\n              errorBody:\n                '500kb max file size. Select a new file and try again.',\n            }\n      );\n      this.requestUpdate();\n    } else {\n      // Simulates network request time\n      const rand = Math.random() * 1000;\n      await new Promise((t) => setTimeout(t, rand));\n      this._files = this._files.map((item) =>\n        id !== item.id\n          ? item\n          : {\n              ...item,\n              state: FILE_UPLOADER_ITEM_STATE.COMPLETE,\n            }\n      );\n      this.requestUpdate();\n      // Shows x icon after 1 second\n      await new Promise((t) => setTimeout(t, 1000));\n      this._files = this._files.map((item) =>\n        id !== item.id\n          ? item\n          : {\n              ...item,\n              state: FILE_UPLOADER_ITEM_STATE.EDIT,\n            }\n      );\n      this.requestUpdate();\n    }\n  }\n\n  /**\n   * The file types the file input should accept, separated by space.\n   */\n  @property()\n  accept = '';\n\n  /**\n   * `true` if the drop container should be disabled.\n   */\n  @property({ type: Boolean, reflect: true })\n  button = false;\n\n  /**\n   * Button kind.\n   */\n  @property({ attribute: 'button-kind' })\n  buttonKind = 'primary';\n\n  /**\n   * Button label.\n   */\n  @property({ attribute: 'button-label' })\n  buttonLabel = 'Add file';\n\n  /**\n   * `true` if the drop container should be disabled.\n   */\n  @property({ type: Boolean, reflect: true })\n  disabled = false;\n\n  /**\n   * Icon description.\n   */\n  @property({ attribute: 'icon-description' })\n  iconDescription = '';\n\n  /**\n   * The input name.\n   */\n  @property({ attribute: 'input-name' })\n  inputName = '';\n\n  /**\n   * The label description text.\n   */\n  @property({ attribute: 'label-description' })\n  labelDescription = '';\n\n  /**\n   * The label title.\n   */\n  @property({ attribute: 'label-title' })\n  labelTitle = '';\n\n  /**\n   * `true` if the drop container should accept more than one files at once.\n   * Note that even with `false` set here, user _can_ select multiple files one by one.\n   */\n  @property({ type: Boolean, reflect: true })\n  multiple = false;\n\n  /**\n   * The size of the button item.\n   */\n  @property({ reflect: true })\n  size = BUTTON_SIZE.MEDIUM;\n\n  /**\n   * The state of this file uploader item.\n   */\n  @property({ reflect: true, attribute: 'input-state' })\n  inputState = '';\n\n  render() {\n    const {\n      accept,\n      button,\n      buttonKind,\n      buttonLabel,\n      disabled,\n      labelDescription,\n      labelTitle,\n      multiple,\n      size,\n      inputState,\n      iconDescription,\n      _files: files,\n      _handleChange: handleChange,\n      _handleDelete: handleDelete,\n    } = this;\n    return html`\n      <cds-file-uploader\n        label-description=\"${ifDefined(labelDescription)}\"\n        label-title=\"${ifDefined(labelTitle)}\"\n        ?disabled=\"${disabled}\">\n        ${!button\n          ? html` <cds-file-uploader-drop-container\n              accept=\"${ifDefined(accept)}\"\n              ?multiple=\"${multiple}\"\n              name=\"${ifDefined(this.inputName)}\"\n              @cds-file-uploader-drop-container-changed=\"${handleChange}\">\n              Drag and drop files here or click to upload\n            </cds-file-uploader-drop-container>`\n          : html` <cds-file-uploader-button\n              size=\"${ifDefined(size)}\"\n              button-kind=\"${buttonKind}\"\n              accept=\"${ifDefined(accept)}\"\n              name=\"${ifDefined(this.inputName)}\"\n              ?multiple=\"${multiple}\"\n              @cds-file-uploader-button-changed=\"${handleChange}\">\n              ${buttonLabel}\n            </cds-file-uploader-button>`}\n        ${files.map(\n          ({ id, invalid, file, state, errorSubject, errorBody }) => html`\n            <cds-file-uploader-item\n              data-file-id=\"${id}\"\n              ?invalid=\"${invalid}\"\n              state=\"${inputState || ifDefined(state)}\"\n              icon-description=\"${ifDefined(iconDescription)}\"\n              error-subject=\"${ifDefined(errorSubject)}\"\n              error-body=\"${ifDefined(errorBody)}\"\n              @cds-file-uploader-item-deleted=\"${handleDelete}\">\n              ${file.name}\n            </cds-file-uploader-item>\n          `\n        )}\n      </cds-file-uploader>\n    `;\n  }\n}\n"],"names":["customElement"],"mappings":"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"}