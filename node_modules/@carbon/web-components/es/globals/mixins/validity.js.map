{"version":3,"file":"validity.js","sources":["../../../src/globals/mixins/validity.ts"],"sourcesContent":["/**\n * Copyright IBM Corp. 2020, 2022\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n/**\n * Form validation status.\n */\nexport enum VALIDATION_STATUS {\n  /**\n   * One indicating no validation error.\n   */\n  NO_ERROR = '',\n\n  /**\n   * One indicating missing required value.\n   */\n  ERROR_REQUIRED = 'required',\n}\n\n/**\n * @param Base The base class.\n * @returns A mix-in implementing `.setCustomValidity()` method.\n */\nconst ValidityMixin = <T extends Constructor<HTMLElement>>(Base: T) => {\n  abstract class ValidityMixinImpl extends Base {\n    // Not using TypeScript `protected` due to: microsoft/TypeScript#17744\n    // Using `string` instead of `VALIDATION_STATUS` until we can require TypeScript 3.8\n    /**\n     * @param state The form validation status.\n     * @returns The form validation error messages associated with the given status.\n     * @protected\n     */\n    _getValidityMessage(state: string) {\n      return {\n        [VALIDATION_STATUS.NO_ERROR]: '',\n        [VALIDATION_STATUS.ERROR_REQUIRED]: this.requiredValidityMessage,\n      }[state];\n    }\n\n    // Not using TypeScript `protected` due to: microsoft/TypeScript#17744\n    // Using `string` instead of `VALIDATION_STATUS` until we can require TypeScript 3.8\n    /**\n     * Checks if the value meets the constraints.\n     *\n     * @returns `VALIDATION_STATUS.NO_ERROR` if the value meets the constraints. Some other values otherwise.\n     * @protected\n     */\n    _testValidity(): string {\n      const { required, value } = this;\n      return required && !value\n        ? VALIDATION_STATUS.ERROR_REQUIRED\n        : VALIDATION_STATUS.NO_ERROR;\n    }\n\n    /**\n     * `true` to show the UI of the invalid state.\n     */\n    abstract invalid: boolean;\n\n    /**\n     * `true` if the value is required.\n     */\n    abstract required: boolean;\n\n    /**\n     * The special validity message for `required`.\n     */\n    abstract requiredValidityMessage: string;\n\n    /**\n     * The validity message.\n     */\n    abstract validityMessage: string;\n\n    /**\n     * The value.\n     */\n    abstract value: string;\n\n    /**\n     * Checks if the value meets the constraints.\n     * Fires cancelable `invalid` event if it doesn't.\n     *\n     * @returns `true` if the value meets the constraints. `false` otherwise.\n     */\n    checkValidity() {\n      const status = this._testValidity();\n      if (status !== VALIDATION_STATUS.NO_ERROR) {\n        if (\n          this.dispatchEvent(\n            new CustomEvent('invalid', {\n              bubbles: false,\n              cancelable: true,\n              composed: false,\n            })\n          )\n        ) {\n          this.invalid = true;\n          this.validityMessage = this._getValidityMessage(status) as string;\n        }\n        return false;\n      }\n      this.invalid = false;\n      this.validityMessage = '';\n      return true;\n    }\n\n    /**\n     * Sets the given custom validity message.\n     *\n     * @param validityMessage The custom validity message\n     */\n    setCustomValidity(validityMessage: string) {\n      this.invalid = Boolean(validityMessage);\n      this.validityMessage = validityMessage;\n    }\n  }\n  return ValidityMixinImpl;\n};\n\nexport default ValidityMixin;\n"],"names":[],"mappings":";;;;;;;AAAA;;;;;AAKG;AAEH;;AAEG;IACS;AAAZ,CAAA,UAAY,iBAAiB,EAAA;AAC3B;;AAEG;AACH,IAAA,iBAAA,CAAA,UAAA,CAAA,GAAA,EAAa;AAEb;;AAEG;AACH,IAAA,iBAAA,CAAA,gBAAA,CAAA,GAAA,UAA2B;AAC7B,CAAC,EAVW,iBAAiB,KAAjB,iBAAiB,GAU5B,EAAA,CAAA,CAAA;AAED;;;AAGG;AACH,MAAM,aAAa,GAAG,CAAqC,IAAO,KAAI;IACpE,MAAe,iBAAkB,SAAQ,IAAI,CAAA;;;AAG3C;;;;AAIG;AACH,QAAA,mBAAmB,CAAC,KAAa,EAAA;YAC/B,OAAO;AACL,gBAAA,CAAC,iBAAiB,CAAC,QAAQ,GAAG,EAAE;AAChC,gBAAA,CAAC,iBAAiB,CAAC,cAAc,GAAG,IAAI,CAAC,uBAAuB;aACjE,CAAC,KAAK,CAAC;;;;AAKV;;;;;AAKG;QACH,aAAa,GAAA;AACX,YAAA,MAAM,EAAE,QAAQ,EAAE,KAAK,EAAE,GAAG,IAAI;YAChC,OAAO,QAAQ,IAAI,CAAC;kBAChB,iBAAiB,CAAC;AACpB,kBAAE,iBAAiB,CAAC,QAAQ;;AA4BhC;;;;;AAKG;QACH,aAAa,GAAA;AACX,YAAA,MAAM,MAAM,GAAG,IAAI,CAAC,aAAa,EAAE;AACnC,YAAA,IAAI,MAAM,KAAK,iBAAiB,CAAC,QAAQ,EAAE;gBACzC,IACE,IAAI,CAAC,aAAa,CAChB,IAAI,WAAW,CAAC,SAAS,EAAE;AACzB,oBAAA,OAAO,EAAE,KAAK;AACd,oBAAA,UAAU,EAAE,IAAI;AAChB,oBAAA,QAAQ,EAAE,KAAK;iBAChB,CAAC,CACH,EACD;AACA,oBAAA,IAAI,CAAC,OAAO,GAAG,IAAI;oBACnB,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC,mBAAmB,CAAC,MAAM,CAAW;;AAEnE,gBAAA,OAAO,KAAK;;AAEd,YAAA,IAAI,CAAC,OAAO,GAAG,KAAK;AACpB,YAAA,IAAI,CAAC,eAAe,GAAG,EAAE;AACzB,YAAA,OAAO,IAAI;;AAGb;;;;AAIG;AACH,QAAA,iBAAiB,CAAC,eAAuB,EAAA;AACvC,YAAA,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC,eAAe,CAAC;AACvC,YAAA,IAAI,CAAC,eAAe,GAAG,eAAe;;AAEzC;AACD,IAAA,OAAO,iBAAiB;AAC1B;;;;"}