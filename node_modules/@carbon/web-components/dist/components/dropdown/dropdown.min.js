/**
 * Copyright IBM Corp. 2019, 2020
 *
 * This source code is licensed under the Apache-2.0 license found in the
 * LICENSE file in the root directory of this source tree.
 */
/**
 * @license
 * 
 * This bundle contains the following third-party dependencies:
 * 
 * Also refer to the following links for the license of other third-party dependencies:
 * 
 * https://www.npmjs.com/package/tslib
 * https://www.npmjs.com/package/lit
 * https://www.npmjs.com/package/@lit/context
 * https://www.npmjs.com/package/lodash-es
 * https://www.npmjs.com/package/@floating-ui/dom
 * https://www.npmjs.com/package/flatpickr
 * https://www.npmjs.com/package/lit-html
 * https://www.npmjs.com/package/lit-element
 * https://www.npmjs.com/package/@lit/reactive-element
 * https://www.npmjs.com/package/@floating-ui/core
 * https://www.npmjs.com/package/@floating-ui/utils
 */

import{__decorate as e}from"../../node_modules/tslib/tslib.es6.min.js";import{classMap as t}from"../../node_modules/lit-html/directives/class-map.min.js";import{ifDefined as i}from"../../node_modules/lit-html/directives/if-defined.min.js";import"../../node_modules/@lit/reactive-element/reactive-element.min.js";import{html as l}from"../../node_modules/lit-html/lit-html.min.js";import{LitElement as o}from"../../node_modules/lit-element/lit-element.min.js";import{property as s}from"../../node_modules/@lit/reactive-element/decorators/property.min.js";import{state as r}from"../../node_modules/@lit/reactive-element/decorators/state.min.js";import{query as a}from"../../node_modules/@lit/reactive-element/decorators/query.min.js";import{prefix as n}from"../../globals/settings.min.js";import d from"../../packages/icons/lib/chevron--down/16.min.js";import c from"../../packages/icons/lib/warning--filled/16.min.js";import h from"../../packages/icons/lib/warning--alt--filled/16.min.js";import p from"../../globals/mixins/focus.min.js";import g from"../../globals/mixins/form.min.js";import u from"../../globals/mixins/host-listener.min.js";import b from"../../globals/mixins/validity.min.js";import m from"../../globals/decorators/host-listener.min.js";import{forEach as v,indexOf as _,find as y}from"../../globals/internal/collection-helpers.min.js";import{DROPDOWN_DIRECTION as $,DROPDOWN_SIZE as f,DROPDOWN_TYPE as I,DROPDOWN_KEYBOARD_ACTION as x,NAVIGATION_DIRECTION as T}from"./defs.min.js";import w from"./dropdown.scss.min.js";import{carbonElement as S}from"../../globals/decorators/carbon-element.min.js";let L=class extends(b(u(g(p(o))))){constructor(){super(...arguments),this._hasAILabel=!1,this._selectedItemContent=null,this._shouldTriggerBeFocusable=!0,this.ariaLabel="",this.direction=$.BOTTOM,this.disabled=!1,this.helperText="",this.hideLabel=!1,this.invalid=!1,this.invalidText="",this.titleText="",this.name="",this.open=!1,this.readOnly=!1,this.required=!1,this.requiredValidityMessage="Please fill out this field.",this.size=f.MEDIUM,this.toggleLabelClosed="",this.toggleLabelOpen="",this.label="",this.type=I.DEFAULT,this.validityMessage="",this.value="",this.warn=!1,this.warnText=""}_selectionShouldChange(e){return!e||e.value!==this.value}_selectionDidChange(e){e&&(this.value=e.value,this._activeDescendant=e.id,v(this.querySelectorAll(this.constructor.selectorItemSelected),(e=>{e.selected=!1,e.setAttribute("aria-selected","false")})),e.selected=!0,e.setAttribute("aria-selected","true"),this._handleUserInitiatedToggle(!1))}_handleClickInner(e){if(!this.readOnly)if(this.shadowRoot.contains(e.target))this._handleUserInitiatedToggle();else{const t=e.target.closest(this.constructor.selectorItem);this.contains(t)&&this._handleUserInitiatedSelectItem(t)}}_handleKeydownInner(e){const{key:t}=e,i=this.constructor.getAction(t);if(this.open)switch(i){case x.CLOSING:this._handleUserInitiatedToggle(!1);break;case x.NAVIGATING:this._navigate(T[t])}else if(i===x.NAVIGATING)this._handleUserInitiatedToggle(!0),this._clearHighlight()}_handleKeypressInner(e){const{key:t}=e,i=this.constructor.getAction(t);if(this.open){if(i===x.TRIGGERING){const e=this.constructor,t=this.querySelector(e.selectorItemHighlighted);t?this._handleUserInitiatedSelectItem(t):this._handleUserInitiatedToggle(!1)}}else if(i===x.TRIGGERING)this._handleUserInitiatedToggle(!0)}_handleFocusOut(e){this.contains(e.relatedTarget)||this._handleUserInitiatedToggle(!1)}_handleSlotchangeHelperText(){this.requestUpdate()}_handleSlotchangeLabelText(){this.requestUpdate()}_handleAILabelSlotChange({target:e}){const t=e.assignedNodes().filter((e=>void 0!==e.matches&&(e.matches(this.constructor.aiLabelItem)||e.matches(this.constructor.slugItem))));this._hasAILabel=Boolean(t),t[0].setAttribute("size","mini"),this.requestUpdate()}_handleUserInitiatedSelectItem(e){if(!(null==e?void 0:e.hasAttribute("disabled"))&&this._selectionShouldChange(e)){const t={bubbles:!0,composed:!0,detail:{item:e}},i=this.constructor,l=new CustomEvent(i.eventBeforeSelect,Object.assign(Object.assign({},t),{cancelable:!0}));if(this.dispatchEvent(l)){this._selectionDidChange(e);const l=new CustomEvent(i.eventSelect,t);this.dispatchEvent(l)}}}_handleUserInitiatedToggle(e=!this.open){const{eventBeforeToggle:t,eventToggle:i}=this.constructor,{disabled:l}=this,o={bubbles:!0,cancelable:!0,composed:!0,detail:{open:e}};l||this.dispatchEvent(new CustomEvent(t,o))&&(this.open=e,this.open||v(this.querySelectorAll(this.constructor.selectorItemHighlighted),(e=>{e.highlighted=!1})),this.requestUpdate(),this.dispatchEvent(new CustomEvent(i,o)))}_clearHighlight(){v(this.querySelectorAll(this.constructor.selectorItem),(e=>{e.highlighted=!1}))}_navigate(e){var t;const i=this.constructor,l=this.querySelectorAll(i.selectorItem),o=this.querySelector(i.selectorItemHighlighted);let s=_(l,o)+e;(null===(t=l[s])||void 0===t?void 0:t.hasAttribute("disabled"))&&(s+=e),s<0&&(s=l.length-1),s>=l.length&&(s=0),v(l,((e,t)=>{e.highlighted=t===s}));const r=l[s];r.scrollIntoView({block:"nearest"});const a=r.id;a&&(this._activeDescendant=a)}_renderPrecedingLabel(){}_renderLabel(){const{label:e,_selectedItemContent:t}=this;return l`
      <span id="trigger-label" class="${n}--list-box__label"
        >${t||e}</span
      >
    `}_renderTitleLabel(){const{disabled:e,hideLabel:i,titleText:o,_slotTitleTextNode:s,_handleSlotchangeLabelText:r}=this,a=t({[`${n}--label`]:!0,[`${n}--label--disabled`]:e,[`${n}--visually-hidden`]:i}),d=o||s&&s.assignedNodes().length>0;return l`
      <label
        id="dropdown-label"
        part="title-text"
        class="${a}"
        for="trigger-button"
        ?hidden="${!d}">
        <slot name="title-text" @slotchange="${r}"
          >${o}</slot
        >
      </label>
    `}_renderFollowingLabel(){}_handleFormdata(e){const{formData:t}=e,{disabled:i,name:l,value:o}=this;i||t.append(l,o)}shouldUpdate(e){const{selectorItem:t}=this.constructor;if(e.has("size")&&v(this.querySelectorAll(t),(e=>{e.size=this.size})),e.has("disabled")&&this.disabled){const{disabled:e}=this;v(this.querySelectorAll(t),(t=>{e?t.disabled=e:t.removeAttribute("disabled")}))}if(e.has("value")){v(this.querySelectorAll(t),(e=>{e.selected=e.value===this.value}));const e=y(this.querySelectorAll(t),(e=>e.value===this.value));if(e){const t=this.ownerDocument.createRange();t.selectNodeContents(e),this._selectedItemContent=t.cloneContents()}else this._selectedItemContent=null}return!0}updated(e){var t,i,l,o,s;this._hasAILabel?this.setAttribute("ai-label",""):this.removeAttribute("ai-label");const r=null===(t=this.shadowRoot)||void 0===t?void 0:t.querySelector("slot[name='ai-label']");r?null==r||r.classList.toggle(`${n}--slug--revert`,null===(i=this.querySelector(`${n}-ai-label`))||void 0===i?void 0:i.hasAttribute("revert-active")):null===(o=null===(l=this.shadowRoot)||void 0===l?void 0:l.querySelector("slot[name='slug']"))||void 0===o||o.classList.toggle(`${n}--slug--revert`,null===(s=this.querySelector(`${n}-slug`))||void 0===s?void 0:s.hasAttribute("revert-active"))}get _classes(){const{disabled:e,size:i,type:l,invalid:o,open:s,warn:r}=this,a=l===I.INLINE,d=this.querySelectorAll(this.constructor.selectorItemSelected).length;return t({[`${n}--dropdown`]:!0,[`${n}--list-box`]:!0,[`${n}--list-box--disabled`]:e,[`${n}--list-box--inline`]:a,[`${n}--list-box--expanded`]:s,[`${n}--list-box--${i}`]:i,[`${n}--dropdown--invalid`]:o,[`${n}--dropdown--warn`]:r,[`${n}--dropdown--inline`]:a,[`${n}--dropdown--selected`]:d>0,[`${n}--list-box__wrapper--decorator`]:this._hasAILabel})}render(){var e;const{ariaLabel:o,_classes:s,disabled:r,helperText:a,invalid:p,invalidText:g,open:u,toggleLabelClosed:b,toggleLabelOpen:m,type:v,warn:_,warnText:y,_activeDescendant:$,_shouldTriggerBeFocusable:f,_handleClickInner:x,_handleKeydownInner:T,_handleKeypressInner:w,_handleSlotchangeHelperText:S,_handleAILabelSlotChange:L,_slotHelperTextNode:A}=this,q=v===I.INLINE;let j;if(u&&!$){const t=this.constructor;j=null===(e=this.querySelectorAll(t.selectorItem)[0])||void 0===e?void 0:e.id}const N=t({[`${n}--form__helper-text`]:!0,[`${n}--form__helper-text--disabled`]:r}),C=t({[`${n}--list-box__menu-icon`]:!0,[`${n}--list-box__menu-icon--open`]:u}),E=(u?m:b)||void 0,G=a||g||y||A&&A.assignedNodes().length>0,O=p?c({class:`${n}--list-box__invalid-icon`,"aria-label":E}):void 0,U=!_||p&&_?void 0:h({class:`${n}--list-box__invalid-icon ${n}--list-box__invalid-icon--warning`,"aria-label":E}),B=p?g:_?y:a,R=l`
      <div
        aria-labelledby="${i(o?void 0:"dropdown-label")}"
        aria-label="${i(o||void 0)}"
        id="menu-body"
        part="menu-body"
        class="${n}--list-box__menu"
        role="listbox"
        tabindex="-1"
        ?hidden=${!u}>
        <slot></slot>
      </div>
    `;return l`
      ${this._renderTitleLabel()}
      <div
        class="${s}"
        ?data-invalid=${p}
        @click=${x}
        @keydown=${T}
        @keypress=${w}>
        <div
          id="${i(f?"trigger-button":void 0)}"
          class="${n}--list-box__field"
          part="trigger-button"
          tabindex="${i(f?"0":void 0)}"
          role="${i(f?"combobox":void 0)}"
          aria-labelledby="${i(f?"dropdown-label":void 0)}"
          aria-expanded="${i(f?String(u):void 0)}"
          aria-haspopup="${i(f?"listbox":void 0)}"
          aria-controls="${i(f?"menu-body":void 0)}"
          aria-activedescendant="${i(f?u?null!=$?$:j:"":void 0)}">
          ${this._renderPrecedingLabel()}${this._renderLabel()}${O}${U}${this._renderFollowingLabel()}
          <div id="trigger-caret" class="${C}">
            ${d({"aria-label":E})}
          </div>
        </div>
        <slot name="ai-label" @slotchange=${L}></slot>
        <slot name="slug" @slotchange=${L}></slot>
        ${R}
      </div>
      <div
        part="helper-text"
        class="${N}"
        ?hidden="${q&&!_&&!p||!G}">
        <slot name="helper-text" @slotchange="${S}"
          >${B}</slot
        >
      </div>
    `}static get selectorItemHighlighted(){return`${n}-dropdown-item[highlighted]`}static get selectorItem(){return`${n}-dropdown-item`}static get selectorItemSelected(){return`${n}-dropdown-item[selected]`}static get eventBeforeSelect(){return`${n}-dropdown-beingselected`}static get eventSelect(){return`${n}-dropdown-selected`}static get eventBeforeToggle(){return`${n}-dropdown-beingtoggled`}static get eventToggle(){return`${n}-dropdown-toggled`}static get slugItem(){return`${n}-slug`}static get aiLabelItem(){return`${n}-ai-label`}static getAction(e){return"Escape"===e?x.CLOSING:e in T?x.NAVIGATING:this.TRIGGER_KEYS.has(e)?x.TRIGGERING:x.NONE}};L.TRIGGER_KEYS=new Set([" ","Enter"]),L.shadowRootOptions=Object.assign(Object.assign({},o.shadowRootOptions),{delegatesFocus:!0}),L.styles=w,e([r()],L.prototype,"_activeDescendant",void 0),e([a(`.${n}--list-box`)],L.prototype,"_listBoxNode",void 0),e([a('slot[name="helper-text"]')],L.prototype,"_slotHelperTextNode",void 0),e([a('slot[name="title-text"]')],L.prototype,"_slotTitleTextNode",void 0),e([m("focusout")],L.prototype,"_handleFocusOut",null),e([s({type:String,reflect:!0,attribute:"aria-label"})],L.prototype,"ariaLabel",void 0),e([s({type:String,reflect:!0})],L.prototype,"direction",void 0),e([s({type:Boolean,reflect:!0})],L.prototype,"disabled",void 0),e([s({attribute:"helper-text"})],L.prototype,"helperText",void 0),e([s({type:Boolean,reflect:!0,attribute:"hide-label"})],L.prototype,"hideLabel",void 0),e([s({type:Boolean,reflect:!0})],L.prototype,"invalid",void 0),e([s({attribute:"invalid-text"})],L.prototype,"invalidText",void 0),e([s({attribute:"title-text"})],L.prototype,"titleText",void 0),e([s()],L.prototype,"name",void 0),e([s({type:Boolean,reflect:!0})],L.prototype,"open",void 0),e([s({type:Boolean,reflect:!0,attribute:"read-only"})],L.prototype,"readOnly",void 0),e([s({type:Boolean,reflect:!0})],L.prototype,"required",void 0),e([s({attribute:"required-validity-message"})],L.prototype,"requiredValidityMessage",void 0),e([s({reflect:!0})],L.prototype,"size",void 0),e([s({attribute:"toggle-label-closed"})],L.prototype,"toggleLabelClosed",void 0),e([s({attribute:"toggle-label-open"})],L.prototype,"toggleLabelOpen",void 0),e([s({attribute:"label"})],L.prototype,"label",void 0),e([s({reflect:!0})],L.prototype,"type",void 0),e([s({attribute:"validity-message"})],L.prototype,"validityMessage",void 0),e([s({reflect:!0})],L.prototype,"value",void 0),e([s({type:Boolean,reflect:!0})],L.prototype,"warn",void 0),e([s({attribute:"warn-text"})],L.prototype,"warnText",void 0),L=e([S(`${n}-dropdown`)],L);var A=L;export{$ as DROPDOWN_DIRECTION,x as DROPDOWN_KEYBOARD_ACTION,f as DROPDOWN_SIZE,I as DROPDOWN_TYPE,T as NAVIGATION_DIRECTION,A as default};
