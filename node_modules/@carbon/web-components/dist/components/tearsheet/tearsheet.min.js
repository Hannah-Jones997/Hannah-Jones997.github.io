/**
 * Copyright IBM Corp. 2019, 2020
 *
 * This source code is licensed under the Apache-2.0 license found in the
 * LICENSE file in the root directory of this source tree.
 */
/**
 * @license
 * 
 * This bundle contains the following third-party dependencies:
 * 
 * Also refer to the following links for the license of other third-party dependencies:
 * 
 * https://www.npmjs.com/package/tslib
 * https://www.npmjs.com/package/lit
 * https://www.npmjs.com/package/@lit/context
 * https://www.npmjs.com/package/lodash-es
 * https://www.npmjs.com/package/@floating-ui/dom
 * https://www.npmjs.com/package/flatpickr
 * https://www.npmjs.com/package/lit-html
 * https://www.npmjs.com/package/lit-element
 * https://www.npmjs.com/package/@lit/reactive-element
 * https://www.npmjs.com/package/@floating-ui/core
 * https://www.npmjs.com/package/@floating-ui/utils
 */

import{__decorate as t}from"../../node_modules/tslib/tslib.es6.min.js";import"../../node_modules/@lit/reactive-element/reactive-element.min.js";import{html as e}from"../../node_modules/lit-html/lit-html.min.js";import{LitElement as s}from"../../node_modules/lit-element/lit-element.min.js";import{property as i}from"../../node_modules/@lit/reactive-element/decorators/property.min.js";import{state as o}from"../../node_modules/@lit/reactive-element/decorators/state.min.js";import{query as n}from"../../node_modules/@lit/reactive-element/decorators/query.min.js";import{queryAssignedElements as a}from"../../node_modules/@lit/reactive-element/decorators/query-assigned-elements.min.js";import{prefix as l,selectorTabbable as h}from"../../globals/settings.min.js";import c from"../../globals/decorators/host-listener.min.js";import r from"../../globals/mixins/host-listener.min.js";import{carbonElement as d}from"../../globals/decorators/carbon-element.min.js";import"../button/button.min.js";import"../button/button-set.min.js";import"../button/button-skeleton.min.js";import"../layer/layer.min.js";import"../button/button-set-base.min.js";import"../modal/modal.min.js";import"../modal/modal-body.min.js";import"../modal/modal-body-content.min.js";import"../modal/modal-close-button.min.js";import"../modal/modal-footer.min.js";import"../modal/modal-footer-button.min.js";import"../modal/modal-header.min.js";import"../modal/modal-heading.min.js";import"../modal/modal-label.min.js";import{TEARSHEET_INFLUENCER_PLACEMENT as _,TEARSHEET_INFLUENCER_WIDTH as p,TEARSHEET_WIDTH as u}from"./defs.min.js";var m;const v=Node.DOCUMENT_POSITION_PRECEDING|Node.DOCUMENT_POSITION_CONTAINS,$=Node.DOCUMENT_POSITION_FOLLOWING|Node.DOCUMENT_POSITION_CONTAINED_BY,g=`${l}--tearsheet`,f=`${l}--modal-header`,b=`${l}--action-set`;function k(t,e){for(let e=t.length-1;e>=0;--e){const s=t[e];if(s.focus(),s.ownerDocument.activeElement===s)return!0}return!1}let y=m=class extends(r(s)){constructor(){super(...arguments),this._launcher=null,this._actionsCount=0,this._hasHeaderActions=!1,this._hasLabel=!1,this._hasSlug=!1,this._hasTitle=!1,this._hasDescription=!1,this._hasInfluencerLeft=!1,this._hasInfluencerRight=!1,this._isOpen=!1,this._hasHeaderNavigation=!1,this._handleClick=t=>{t.composedPath().indexOf(this.shadowRoot)<0&&!this.preventCloseOnClickOutside&&this._handleUserInitiatedClose(t.target)},this._handleBlur=async({target:t,relatedTarget:e})=>{var s;if(!this._topOfStack())return;const{open:i,_startSentinelNode:o,_endSentinelNode:n}=this,a=t!==this&&this.contains(t),l=e!==this&&(this.contains(e)||(null===(s=this.shadowRoot)||void 0===s?void 0:s.contains(e))&&e!==o&&e!==n),{selectorTabbable:h}=this.constructor;if(i&&e&&a&&!l){const s=t.compareDocumentPosition(e);e===o||s&v?(await this.constructor._delay(),k(this.querySelectorAll(h))||e===this||this.focus()):(e===n||s&$)&&(await this.constructor._delay(),k(this.querySelectorAll(h))||this.focus())}},this._handleKeydown=({key:t,target:e})=>{"Esc"!==t&&"Escape"!==t||!this._topOfStack()||this._handleUserInitiatedClose(e)},this.ariaLabel="",this.closeIconDescription="Close",this.hasCloseIcon=!1,this.influencerPlacement=_.RIGHT,this.influencerWidth=p.NARROW,this.open=!1,this.preventCloseOnClickOutside=!1,this.width=u.NARROW,this._checkUpdateActionSizes=()=>{if(this._actions)for(let t=0;t<this._actions.length;t++)this._actions[t].setAttribute("size","wide"===this.width?"2xl":"xl")},this._maxActions=4,this._stackDepth=-1,this._stackPosition=-1,this._topOfStack=()=>this._stackDepth===this._stackPosition,this._notifyStack=()=>{m._stack.all.forEach((t=>{t(Math.min(m._stack.open.length,3),m._stack.open.indexOf(t)+1)}))},this._handleStackChange=(t,e)=>{this._stackDepth=t,this._stackPosition=e,this._stackDepth>1&&this._stackPosition>0?(this.setAttribute("stack-position",`${e}`),this.setAttribute("stack-depth",`${this._stackDepth}`)):(this.removeAttribute("stack-position"),this.removeAttribute("stack-depth"))},this._updateStack=()=>{if(this.open)m._stack.open.push(this._handleStackChange);else{const t=m._stack.open.indexOf(this._handleStackChange);t>=0&&m._stack.open.splice(t,1)}this._notifyStack()},this.actionsMultiple=["","single","double","triple"][this._actionsCount],this._checkSetOpen=()=>{const{_tearsheet:t}=this;t&&this._isOpen?t.addEventListener("transitionend",(()=>{this._isOpen=!1})):window.requestAnimationFrame((()=>{this._isOpen=this.open}))}}_checkSetHasSlot(t){var e,s;const i=t.target,o=i.getAttribute("data-postfix"),n=o?`-${o}`:"";this[`_has-${i.name}${n}`.replace(/-./g,(t=>t[1].toUpperCase()))]=(null!==(s=null===(e=null==i?void 0:i.assignedElements())||void 0===e?void 0:e.length)&&void 0!==s?s:0)>0}_handleClickContainer(t){t.target.matches(this.constructor.selectorCloseButton)&&this._handleUserInitiatedClose(t.target)}_handleUserInitiatedClose(t){if(this.open){const e={bubbles:!0,cancelable:!0,composed:!0,detail:{triggeredBy:t}};this.dispatchEvent(new CustomEvent(this.constructor.eventBeforeClose,e))&&(this.open=!1,this.dispatchEvent(new CustomEvent(this.constructor.eventClose,e)))}}_handleSlugChange(t){const e=t.target.assignedElements();this._hasSlug=e.length>0,this._hasSlug?(e[0].setAttribute("size","lg"),this.setAttribute("slug","")):this.removeAttribute("slug")}_handleActionsChange(t){var e;const s=t.target,i=null==s?void 0:s.assignedElements(),o=null!==(e=null==i?void 0:i.length)&&void 0!==e?e:0;o>this._maxActions?(this._actionsCount=this._maxActions,console.error(`Too many tearsheet actions, max ${this._maxActions}.`)):this._actionsCount=o;for(let t=0;t<(null==i?void 0:i.length);t++)t+1>this._maxActions?(i[t].setAttribute("hidden","true"),i[t].setAttribute(`data-actions-limit-${this._maxActions}-exceeded`,`${i.length}`)):i[t].classList.add(`${b}__action-button`);this._checkUpdateActionSizes()}connectedCallback(){super.connectedCallback(),m._stack.all.push(this._handleStackChange)}disconnectedCallback(){super.disconnectedCallback();const t=m._stack.all.indexOf(this._handleStackChange);m._stack.all.splice(t,1);const e=m._stack.all.indexOf(this._handleStackChange);m._stack.open.splice(e,1)}render(){const{closeIconDescription:t,influencerPlacement:s,influencerWidth:i,open:o,width:n}=this,a=["","single","double","triple"][this._actionsCount],h=e`<div
      class=${`${g}__header-fields`}>
      <h2 class=${`${f}__label`} ?hidden=${!this._hasLabel}>
        <slot name="label" @slotchange=${this._checkSetHasSlot}></slot>
      </h2>
      <h3
        class=${`${f}__heading ${g}__heading`}
        ?hidden=${!this._hasTitle}>
        <slot name="title" @slotchange=${this._checkSetHasSlot}></slot>
      </h3>
      <div
        class=${`${g}__header-description`}
        ?hidden=${!this._hasDescription}>
        <slot name="description" @slotchange=${this._checkSetHasSlot}></slot>
      </div>
    </div>`,c=e` <div
      class=${`${g}__header-actions`}
      ?hidden=${!this._hasHeaderActions||"narrow"===this.width}>
      <slot name="header-actions" @slotchange=${this._checkSetHasSlot}></slot>
    </div>`,r=e` <cds-modal-header
      class=${`${g}__header`}
      ?has-close-icon=${this.hasCloseIcon||0===(null==this?void 0:this._actionsCount)}
      ?has-navigation=${this._hasHeaderNavigation&&"wide"===this.width}
      ?has-header-actions=${this._hasHeaderActions&&"wide"===this.width}
      ?has-actions=${(null==this?void 0:this._actionsCount)>0}
      ?has-slug=${null==this?void 0:this._hasSlug}
      width=${n}>
      ${this.width===u.WIDE?e`<cds-layer level="1" class=${`${g}__header-content`}
            >${h}${c}</cds-layer
          >`:e`<div>${h}${c}</div>`}

      <div
        class=${`${g}__header-navigation`}
        ?hidden=${!this._hasHeaderNavigation||"narrow"===this.width}>
        <slot
          name="header-navigation"
          @slotchange=${this._checkSetHasSlot}></slot>
      </div>
      <slot name="slug" @slotchange=${this._handleSlugChange}></slot>
      ${this.hasCloseIcon||0===(null==this?void 0:this._actionsCount)?e`<cds-modal-close-button
            close-button-label=${t}
            @click=${this._handleUserInitiatedClose}></cds-modal-close-button>`:""}
    </cds-modal-header>`;return e`
      <a
        id="start-sentinel"
        class="${l}--visually-hidden"
        href="javascript:void 0"
        role="navigation"></a>
      <div
        aria-label=${this.ariaLabel}
        class=${`${g}__container ${l}--modal-container ${l}--modal-container--sm`}
        part="dialog"
        role="complementary"
        ?open=${this._isOpen}
        ?opening=${o&&!this._isOpen}
        ?closing=${!o&&this._isOpen}
        width=${n}
        stack-position=${this._stackPosition}
        stack-depth=${this._stackDepth}
        @click=${this._handleClickContainer}>
        <!-- Header -->
        ${r}

        <!-- Body  -->
        <cds-modal-body class=${`${g}__body`} width=${n}>
          <!-- Influencer when on left -->
          ${s!==_.RIGHT?e`<div
                class=${`${g}__influencer`}
                ?wide=${"wide"===i}
                ?hidden=${!this._hasInfluencerLeft||this.width===u.NARROW}>
                <slot
                  name="influencer"
                  data-postfix="left"
                  @slotchange=${this._checkSetHasSlot}></slot>
              </div>`:""}

          <div class=${`${g}__right`}>
            <div class=${`${g}__main`}>
              <div class=${`${g}__content`}>
                <cds-layer level="0">
                  <slot></slot>
                </cds-layer>
              </div>

              <!-- Influencer when on right -->
              ${s===_.RIGHT?e`<div
                    class=${`${g}__influencer`}
                    ?wide=${i}
                    ?hidden=${!this._hasInfluencerRight||this.width===u.NARROW}>
                    <slot
                      name="influencer"
                      data-postfix="right"
                      @slotchange=${this._checkSetHasSlot}></slot>
                  </div>`:""}
            </div>
            <!-- Action buttons -->
            <cds-button-set-base
              class=${`${g}__buttons ${g}__button-container`}
              actions-multiple=${a}
              ?tearsheet-wide=${"wide"===n}
              ?hidden=${0===this._actionsCount}>
              <slot
                name="actions"
                @slotchange=${this._handleActionsChange}></slot>
            </cds-button-set-base>
          </div>
        </cds-modal-body>
      </div>
      <a
        id="end-sentinel"
        class="${l}--visually-hidden"
        href="javascript:void 0"
        role="navigation"></a>
    `}async updated(t){if(t.has("width")&&this._checkUpdateActionSizes(),"development"===production&&(t.has("width")||t.has("_hasHeaderNavigation")||t.has("_hasInfluencerLeft")||t.has("_hasInfluencerRight")||t.has("_hasHeaderActions"))&&"narrow"===this.width&&(this._hasHeaderNavigation&&console.error("Header navigation is not permitted in narrow Tearsheet."),(this._hasInfluencerLeft||this._hasInfluencerRight)&&console.error("Influencer is not permitted in narrow Tearsheet."),this._hasHeaderActions&&console.error("Header actions are not permitted in narrow Tearsheet.")),t.has("open"))if(this._updateStack(),this._checkSetOpen(),this.open){this._launcher=this.ownerDocument.activeElement;const t=this.selectorInitialFocus&&this.querySelector(this.selectorInitialFocus);await this.constructor._delay(),t?t.focus():k(this.querySelectorAll(this.constructor.selectorTabbable))||this.focus()}else this._launcher&&"function"==typeof this._launcher.focus&&(this._launcher.focus(),this._launcher=null)}static _delay(t=0){return new Promise((e=>{setTimeout(e,t)}))}static get selectorCloseButton(){return`[data-modal-close],${l}-modal-close-button`}static get selectorTabbable(){return h}static get eventBeforeClose(){return`${l}-tearsheet-beingclosed`}static get eventClose(){return`${l}-tearsheet-closed`}static get eventNavigateBack(){return`${l}-tearsheet-header-navigate-back`}};y._stack={open:[],all:[]},t([n("#start-sentinel")],y.prototype,"_startSentinelNode",void 0),t([n("#end-sentinel")],y.prototype,"_endSentinelNode",void 0),t([n(`.${g}__container`)],y.prototype,"_tearsheet",void 0),t([a({slot:"actions",selector:`${l}-button`})],y.prototype,"_actions",void 0),t([o()],y.prototype,"_actionsCount",void 0),t([o()],y.prototype,"_hasHeaderActions",void 0),t([o()],y.prototype,"_hasLabel",void 0),t([o()],y.prototype,"_hasSlug",void 0),t([o()],y.prototype,"_hasTitle",void 0),t([o()],y.prototype,"_hasDescription",void 0),t([o()],y.prototype,"_hasInfluencerLeft",void 0),t([o()],y.prototype,"_hasInfluencerRight",void 0),t([o()],y.prototype,"_isOpen",void 0),t([o()],y.prototype,"_hasHeaderNavigation",void 0),t([c("click")],y.prototype,"_handleClick",void 0),t([c("shadowRoot:focusout")],y.prototype,"_handleBlur",void 0),t([c("document:keydown")],y.prototype,"_handleKeydown",void 0),t([i({reflect:!0,attribute:"aria-label"})],y.prototype,"ariaLabel",void 0),t([i({reflect:!0,attribute:"close-icon-description"})],y.prototype,"closeIconDescription",void 0),t([i({reflect:!0,type:Boolean,attribute:"has-close-icon"})],y.prototype,"hasCloseIcon",void 0),t([i({reflect:!0,attribute:"influencer-placement"})],y.prototype,"influencerPlacement",void 0),t([i({reflect:!0,attribute:"influencer-width"})],y.prototype,"influencerWidth",void 0),t([i({type:Boolean,reflect:!0})],y.prototype,"open",void 0),t([i({type:Boolean,attribute:"prevent-close-on-click-outside"})],y.prototype,"preventCloseOnClickOutside",void 0),t([i({reflect:!0,attribute:"selector-initial-focus",type:String})],y.prototype,"selectorInitialFocus",void 0),t([i({reflect:!0,attribute:"width"})],y.prototype,"width",void 0),t([o()],y.prototype,"_stackDepth",void 0),t([o()],y.prototype,"_stackPosition",void 0),y=m=t([d(`${l}-tearsheet`)],y);export{_ as TEARSHEET_INFLUENCER_PLACEMENT,p as TEARSHEET_INFLUENCER_WIDTH,u as TEARSHEET_WIDTH};
