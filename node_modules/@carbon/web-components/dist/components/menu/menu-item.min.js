/**
 * Copyright IBM Corp. 2019, 2020
 *
 * This source code is licensed under the Apache-2.0 license found in the
 * LICENSE file in the root directory of this source tree.
 */
/**
 * @license
 * 
 * This bundle contains the following third-party dependencies:
 * 
 * Also refer to the following links for the license of other third-party dependencies:
 * 
 * https://www.npmjs.com/package/tslib
 * https://www.npmjs.com/package/lit
 * https://www.npmjs.com/package/@lit/context
 * https://www.npmjs.com/package/lodash-es
 * https://www.npmjs.com/package/@floating-ui/dom
 * https://www.npmjs.com/package/flatpickr
 * https://www.npmjs.com/package/lit-html
 * https://www.npmjs.com/package/lit-element
 * https://www.npmjs.com/package/@lit/reactive-element
 * https://www.npmjs.com/package/@floating-ui/core
 * https://www.npmjs.com/package/@floating-ui/utils
 */

import{__decorate as e}from"../../node_modules/tslib/tslib.es6.min.js";import"../../node_modules/@lit/reactive-element/reactive-element.min.js";import{html as t}from"../../node_modules/lit-html/lit-html.min.js";import{LitElement as s}from"../../node_modules/lit-element/lit-element.min.js";import{property as i}from"../../node_modules/@lit/reactive-element/decorators/property.min.js";import{state as o}from"../../node_modules/@lit/reactive-element/decorators/state.min.js";import{prefix as n}from"../../globals/settings.min.js";import r from"./menu-item.scss.min.js";import{carbonElement as u}from"../../globals/decorators/carbon-element.min.js";import l from"../../packages/icons/lib/caret--left/16.min.js";import a from"../../packages/icons/lib/caret--right/16.min.js";import{consume as m}from"../../node_modules/@lit/context/lib/decorators/consume.min.js";import{MenuContext as h}from"./menu-context.min.js";import d from"../../packages/icons/lib/checkmark/16.min.js";import c from"../../globals/decorators/host-listener.min.js";import p from"../../globals/mixins/host-listener.min.js";import{MENU_ITEM_KIND as b,MENU_SIZE as v}from"./defs.min.js";let y=class extends(p(p(s))){constructor(){var e;super(...arguments),this.hoverIntentDelay=150,this.submenuOpen=!1,this.kind=b.DEFAULT,this.boundaries={x:-1,y:-1},this.ariaChecked=null!==(e=this.getAttribute("selected"))&&void 0!==e?e:"false",this.isRtl=!1,this.hasSubmenu=!1,this._handleClick=e=>{this.hasSubmenu?this._openSubmenu():"keydown"===e.type&&this.click()},this._handleMouseEnter=()=>{this.hoverIntentTimeout=setTimeout((()=>{this._openSubmenu()}),this.hoverIntentDelay)},this._handleMouseLeave=()=>{this.hoverIntentTimeout&&(clearTimeout(this.hoverIntentTimeout),this._closeSubmenu(),this.focus())},this._openSubmenu=()=>{const{x:e,y:t,width:s,height:i}=this.getBoundingClientRect();this.isRtl?this.boundaries={x:[-e,e-s],y:[t,t+i]}:this.boundaries={x:[e,e+s],y:[t,t+i]},this.submenuOpen=!0},this._registerSubMenuItems=()=>{const e=new MutationObserver((e=>{var t,s,i,o,r;for(const u of e)if("childList"===u.type){const e=null===(t=this.shadowRoot)||void 0===t?void 0:t.querySelector('slot[name="submenu"]'),u=null===(i=null===(s=null==e?void 0:e.assignedElements)||void 0===s?void 0:s.call(e))||void 0===i?void 0:i[0];if(u)switch(u.tagName){case"CDS-MENU-ITEM-RADIO-GROUP":this.submenuEntry=u.querySelector(`${n}-menu-item`);break;case"CDS-MENU-ITEM-GROUP":{const e=null===(r=null===(o=u.shadowRoot)||void 0===o?void 0:o.querySelector("slot"))||void 0===r?void 0:r.assignedElements(),t=(null==e?void 0:e.length)&&e[0];this.submenuEntry=t;break}case"CDS-MENU-ITEM":this.submenuEntry=u}}}));e.observe(this.shadowRoot,{childList:!0,subtree:!0})},this._closeSubmenu=()=>{var e,t;this.boundaries={x:-1,y:-1},this.submenuOpen=!1,null===(t=null===(e=this.shadowRoot)||void 0===e?void 0:e.querySelector(`.${n}--menu-item`))||void 0===t||t.focus()},this._handleKeyDown=e=>{this.hasSubmenu&&["ArrowRight","Enter"," "].includes(e.key)?(this._openSubmenu(),setTimeout((()=>{this.submenuEntry.focus()})),e.stopPropagation()):"Enter"!==e.key&&" "!==e.key||this._handleClick(e)}}async dispatchIconDetect(){!!this.querySelector('[slot="render-icon"]')&&(await void 0,this.dispatchEvent(new CustomEvent("icon-detect",{bubbles:!0,composed:!0})))}_updateAttributes(){this.disabled&&!this.hasSubmenu?this.setAttribute("aria-disabled",this.disabled):this.removeAttribute("aria-disabled"),this.hasSubmenu?this.setAttribute("aria-haspopup",this.hasSubmenu+""):this.removeAttribute("aria-haspopup"),this.closest(`${n}-menu-item-radio-group`)?(this.setAttribute("role","menuitemradio"),this.setAttribute("aria-checked",this.ariaChecked+"")):this.getAttribute("role")||this.setAttribute("role","menuitem"),this.setAttribute("tabindex","-1")}firstUpdated(){this.hasSubmenu=!!this.querySelector('[slot="submenu"]'),this.dispatchIconDetect(),this.isRtl="rtl"===document.dir,this._registerSubMenuItems(),this._updateAttributes(),this.addEventListener(`${n}-menu-closed`,(()=>{this.focus(),this._closeSubmenu()}))}updated(e){this.hasSubmenu?this.setAttribute("aria-expanded",this.hasSubmenu+""):this.removeAttribute("aria-expanded"),this.kind===b.DANGER&&this.classList.toggle(`${n}--menu-item--danger`)}handleClick(e){this._handleClick(e)}handleMouseEnter(){this.hasSubmenu&&this._handleMouseEnter()}handleMouseLeave(){this.hasSubmenu&&this._handleMouseLeave()}handleKeyDown(e){this._handleKeyDown(e)}render(){var e,s,i;const{label:o,shortcut:r,submenuOpen:u,boundaries:m,isRtl:h}=this,c=(null===(e=this.context)||void 0===e?void 0:e.hasSelectableItems)?`${n}--menu--with-selectable-items`:"";return t`
      <div class="${n}--menu-item__selection-icon">
        ${"true"===this.ariaChecked?d():void 0}
      </div>

      <div class="${n}--menu-item__icon">
        <slot name="render-icon"></slot>
      </div>
      <div class="${n}--menu-item__label">${o}</div>
      ${r&&!this.hasSubmenu?t` <div class="${n}--menu-item__shortcut">${r}</div> `:t``}
      ${this.hasSubmenu?t`
            <div class="${n}--menu-item__shortcut">
              ${h?l():a()}
            </div>
            <cds-menu
              className=${c}
              size=${null!==(i=null===(s=this.parentElement)||void 0===s?void 0:s.getAttribute("size"))&&void 0!==i?i:v.LARGE}
              ?isChild="${this.hasSubmenu}"
              label="${o}"
              .open="${u}"
              .x="${m.x}"
              .y="${m.y}">
              <slot name="submenu"></slot>
            </cds-menu>
          `:t``}
    `}};y.styles=r,e([m({context:h})],y.prototype,"context",void 0),e([i({type:String})],y.prototype,"label",void 0),e([i({type:String})],y.prototype,"shortcut",void 0),e([i({type:Boolean})],y.prototype,"disabled",void 0),e([i({type:Boolean})],y.prototype,"submenuOpen",void 0),e([i()],y.prototype,"kind",void 0),e([i()],y.prototype,"boundaries",void 0),e([i({attribute:"aria-checked"})],y.prototype,"ariaChecked",void 0),e([o()],y.prototype,"submenuEntry",void 0),e([o()],y.prototype,"isRtl",void 0),e([o()],y.prototype,"hasSubmenu",void 0),e([c("click",{capture:!0})],y.prototype,"handleClick",null),e([c("mouseenter")],y.prototype,"handleMouseEnter",null),e([c("mouseleave")],y.prototype,"handleMouseLeave",null),e([c("keydown")],y.prototype,"handleKeyDown",null),y=e([u(`${n}-menu-item`)],y);export{b as MENU_ITEM_KIND,v as MENU_SIZE};
