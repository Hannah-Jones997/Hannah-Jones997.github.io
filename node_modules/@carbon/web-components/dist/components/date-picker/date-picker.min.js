/**
 * Copyright IBM Corp. 2019, 2020
 *
 * This source code is licensed under the Apache-2.0 license found in the
 * LICENSE file in the root directory of this source tree.
 */
/**
 * @license
 * 
 * This bundle contains the following third-party dependencies:
 * 
 * Also refer to the following links for the license of other third-party dependencies:
 * 
 * https://www.npmjs.com/package/tslib
 * https://www.npmjs.com/package/lit
 * https://www.npmjs.com/package/@lit/context
 * https://www.npmjs.com/package/lodash-es
 * https://www.npmjs.com/package/@floating-ui/dom
 * https://www.npmjs.com/package/flatpickr
 * https://www.npmjs.com/package/lit-html
 * https://www.npmjs.com/package/lit-element
 * https://www.npmjs.com/package/@lit/reactive-element
 * https://www.npmjs.com/package/@floating-ui/core
 * https://www.npmjs.com/package/@floating-ui/utils
 */

import{__decorate as e}from"../../node_modules/tslib/tslib.es6.min.js";import"../../node_modules/@lit/reactive-element/reactive-element.min.js";import{html as t}from"../../node_modules/lit-html/lit-html.min.js";import{LitElement as a}from"../../node_modules/lit-element/lit-element.min.js";import{property as r}from"../../node_modules/@lit/reactive-element/decorators/property.min.js";import{query as o}from"../../node_modules/@lit/reactive-element/decorators/query.min.js";import s from"../../node_modules/flatpickr/dist/esm/index.min.js";import{prefix as n}from"../../globals/settings.min.js";import i from"../../globals/mixins/form.min.js";import l from"../../globals/mixins/host-listener.min.js";import c from"../../globals/decorators/host-listener.min.js";import{getISODateString as d,parseISODateString as p}from"./iso-date.min.js";import m from"./append-to-plugin.min.js";import u from"./css-class-plugin.min.js";import h from"./fix-events-plugin.min.js";import k from"./focus-plugin.min.js";import y from"./icon-plugin.min.js";import _ from"./month-select-plugin.min.js";import f from"./range-plugin.min.js";import g from"./shadow-dom-events-plugin.min.js";import v from"./state-handshake-plugin.min.js";import F from"./date-picker.scss.min.js";import{carbonElement as b}from"../../globals/decorators/carbon-element.min.js";var D;!function(e){e.SIMPLE="simple",e.SINGLE="single",e.RANGE="range"}(D||(D={})),s.l10ns.en.weekdays.shorthand.forEach(((e,t)=>{const a=s.l10ns.en.weekdays.shorthand;"Thu"===a[t]||"Th"===a[t]?a[t]="Th":a[t]=a[t].charAt(0)}));let C=class extends(l(i(a))){constructor(){super(...arguments),this._dateInteractNode=null,this._handleChange=({detail:e})=>{this._value=e.selectedDates.map((e=>d(e))).join("/")},this._handleFlatpickrError=e=>{this.dispatchEvent(new CustomEvent(this.constructor.eventFlatpickrError,{bubbles:!0,cancelable:!1,composed:!0,detail:{error:e}}))},this.calendar=null,this.allowInput=!0,this.closeOnSelect=!0,this.disabled=!1,this.name="",this.open=!1,this.readonly=!1}get _mode(){const{selectorInputTo:e}=this.constructor;return this.querySelector(e)?D.RANGE:this.querySelector(`${n}-date-picker-input[kind="single"]`)?D.SINGLE:D.SIMPLE}get _datePickerPlugins(){const{classCalendarContainer:e,classMonth:t,classWeekdays:a,classDays:r,classWeekday:o,classDay:s,classNoBorder:n,selectorInputFrom:i,selectorInputTo:l,_selectorFlatpickrMonthYearContainer:c,_selectorFlatpickrYearContainer:d,_selectorFlatpickrCurrentMonth:p,_selectorFlatpickrMonth:F,_selectorFlatpickrWeekdays:b,_selectorFlatpickrDays:C,_selectorFlatpickrWeekday:E,_selectorFlatpickrDay:j,_classFlatpickrCurrentMonth:w,_classFlatpickrToday:I}=this.constructor,{_floatingMenuContainerNode:N,_mode:$}=this,M=this.querySelector(i),x=this.querySelector(l),S=[m({appendTo:N}),u({classCalendarContainer:e,classMonth:t,classWeekdays:a,classDays:r,classWeekday:o,classDay:s,classNoBorder:n,selectorFlatpickrMonth:F,selectorFlatpickrWeekdays:b,selectorFlatpickrDays:C,selectorFlatpickrWeekday:E,selectorFlatpickrDay:j,classFlatpickrToday:I}),h({inputFrom:M,inputTo:x}),k({inputFrom:M,inputTo:x}),y(),_({selectorFlatpickrMonthYearContainer:c,selectorFlatpickrYearContainer:d,selectorFlatpickrCurrentMonth:p,classFlatpickrCurrentMonth:w}),g(),v(this)];return $===D.RANGE&&S.push(f({input:x})),S}get _datePickerOptions(){var e;const{locale:t=this.constructor.defaultLocale,enabledRange:a,_dateInteractNode:r,_datePickerPlugins:o,_handleFlatpickrError:s}=this,{input:n}=r,[i,l]=a?a.split("/"):[];return{allowInput:this.allowInput,closeOnSelect:this.closeOnSelect,dateFormat:null!==(e=this.dateFormat)&&void 0!==e?e:this.constructor.defaultDateFormat,disableMobile:!0,errorHandler:s,locale:t,maxDate:l,minDate:i,positionElement:n,plugins:o}}_handleFormdata(e){const{formData:t}=e,{disabled:a,name:r,value:o}=this;a||t.append(r,o)}_handleSlotChange({target:e}){const{_dateInteractNode:t}=this,a=e.assignedNodes().find((e=>e.nodeType===Node.ELEMENT_NODE&&e.matches(this.constructor.selectorInputFrom)));t!==a&&(this._dateInteractNode=a,this._instantiateDatePicker())}_setCalendar(e,t){const{disabled:a,dateFormat:r,open:o,readonly:s,minDate:n,maxDate:i,value:l}=this,{selectorInputFrom:c,selectorInputTo:d}=this.constructor,m=this.querySelector(c),u=this.querySelector(d);if("dateFormat"===e&&t.set({dateFormat:r}),"date"===e){if(!p(n))throw new Error(`Wrong date format found in \`minDate\` property: ${n}`);if(!p(i))throw new Error(`Wrong date format found in \`maxDate\` property: ${i}`);if(n&&i&&n>i)throw new Error(`\`maxDate\` property, shouldn't be smaller than the \`minDate\` property. You have: minDate: ${n}, maxDate: ${i}`);t.set({minDate:n,maxDate:i})}if("open"===e&&(o&&!s?t.open():t.close()),"disabled"===e&&[m,u].forEach((e=>{e&&(e.disabled=a,e.readonly=s)})),"value"===e){const e=l.split("/").filter(Boolean).map((e=>p(e)));if(e.some((e=>isNaN(Number(e)))))throw new Error(`Wrong date format found in \`value\` property: ${l}`);const[a,r]=e;if(a&&r&&a>r)throw new Error(`In \`value\` property, the end date shouldn't be smaller than the start date. You have: ${l}`);t&&(t.setDate(e),[m,u].forEach(((a,r)=>{a&&(a.value=e[r]?t.formatDate(new Date(e[r]),t.config.dateFormat):"")})))}return t}_instantiateDatePicker(){this._releaseDatePicker();const{_dateInteractNode:e}=this;e&&e.input&&"simple"!==this._mode&&(this.calendar=s(e.input,this._datePickerOptions));const{calendar:t,disabled:a,dateFormat:r,open:o,readonly:n,minDate:i,maxDate:l,value:c}=this;return t&&(r&&this._setCalendar("dateFormat",t),(i||l)&&this._setCalendar("date",t),o&&this._setCalendar("open",t),(a||n)&&this._setCalendar("disabled",t),c&&this._setCalendar("value",t)),t}_releaseDatePicker(){return this.calendar&&(this.calendar.destroy(),this.calendar=null),this.calendar}get value(){return this._value}set value(e){const{_value:t}=this;this._value=e,this.requestUpdate("value",t)}connectedCallback(){super.connectedCallback(),this._instantiateDatePicker()}disconnectedCallback(){this._releaseDatePicker(),super.disconnectedCallback()}updated(e){const{calendar:t}=this;t&&(e.has("dateFormat")&&this._setCalendar("dateFormat",t),(e.has("minDate")||e.has("maxDate"))&&this._setCalendar("date",t),e.has("open")&&this._setCalendar("open",t),(e.has("disabled")||e.has("readonly"))&&this._setCalendar("disabled",t),e.has("value")&&this._setCalendar("value",t))}render(){const{_handleSlotChange:e}=this;return t`
      <a
        class="${n}--visually-hidden"
        href="javascript:void 0"
        role="navigation"
        tabindex="-1"></a>
      <slot @slotchange="${e}"></slot>
      <div id="floating-menu-container"></div>
      <a
        class="${n}--visually-hidden"
        href="javascript:void 0"
        role="navigation"
        tabindex="-1"></a>
    `}static get classCalendarContainer(){return`${n}--date-picker__calendar`}static get classMonth(){return`${n}--date-picker__month`}static get classWeekdays(){return`${n}--date-picker__weekdays`}static get classDays(){return`${n}--date-picker__days`}static get classWeekday(){return`${n}--date-picker__weekday`}static get classDay(){return`${n}--date-picker__day`}static get selectorInputFrom(){return`${n}-date-picker-input,${n}-date-picker-input[kind="from"]`}static get selectorInputTo(){return`${n}-date-picker-input[kind="to"]`}static get eventFlatpickrError(){return`${n}-date-picker-flatpickr-error`}static get eventChange(){return`${n}-date-picker-changed`}};C._selectorFlatpickrMonthYearContainer=".flatpickr-current-month",C._selectorFlatpickrYearContainer=".numInputWrapper",C._selectorFlatpickrCurrentMonth=".cur-month",C._selectorFlatpickrMonth=".flatpickr-month",C._selectorFlatpickrWeekdays=".flatpickr-weekdays",C._selectorFlatpickrDays=".flatpickr-days",C._selectorFlatpickrWeekday=".flatpickr-weekday",C._selectorFlatpickrDay=".flatpickr-day",C._classFlatpickrCurrentMonth="cur-month",C._classFlatpickrToday="today",C.classNoBorder="no-border",C.defaultDateFormat="m/d/Y",C.defaultLocale=s.l10ns.default,C.styles=F,e([o("#floating-menu-container")],C.prototype,"_floatingMenuContainerNode",void 0),e([c("eventChange")],C.prototype,"_handleChange",void 0),e([r({type:Boolean,reflect:!0,attribute:"allow-input"})],C.prototype,"allowInput",void 0),e([r({type:Boolean,reflect:!0,attribute:"close-on-select"})],C.prototype,"closeOnSelect",void 0),e([r({attribute:"date-format"})],C.prototype,"dateFormat",void 0),e([r({type:Boolean,reflect:!0})],C.prototype,"disabled",void 0),e([r({attribute:"enabled-range"})],C.prototype,"enabledRange",void 0),e([r({attribute:!1})],C.prototype,"locale",void 0),e([r({attribute:"max-date"})],C.prototype,"maxDate",void 0),e([r({attribute:"min-date"})],C.prototype,"minDate",void 0),e([r()],C.prototype,"name",void 0),e([r({type:Boolean,reflect:!0})],C.prototype,"open",void 0),e([r({type:Boolean,reflect:!0})],C.prototype,"readonly",void 0),e([r()],C.prototype,"value",null),C=e([b(`${n}-date-picker`)],C);
