/**
 * Copyright IBM Corp. 2019, 2020
 *
 * This source code is licensed under the Apache-2.0 license found in the
 * LICENSE file in the root directory of this source tree.
 */
/**
 * @license
 * 
 * This bundle contains the following third-party dependencies:
 * 
 * Also refer to the following links for the license of other third-party dependencies:
 * 
 * https://www.npmjs.com/package/tslib
 * https://www.npmjs.com/package/lit
 * https://www.npmjs.com/package/@lit/context
 * https://www.npmjs.com/package/lodash-es
 * https://www.npmjs.com/package/@floating-ui/dom
 * https://www.npmjs.com/package/flatpickr
 * https://www.npmjs.com/package/lit-html
 * https://www.npmjs.com/package/lit-element
 * https://www.npmjs.com/package/@lit/reactive-element
 * https://www.npmjs.com/package/@floating-ui/core
 * https://www.npmjs.com/package/@floating-ui/utils
 */

import{__decorate as t}from"../../node_modules/tslib/tslib.es6.min.js";import"../../node_modules/@lit/reactive-element/reactive-element.min.js";import{html as e}from"../../node_modules/lit-html/lit-html.min.js";import{LitElement as i}from"../../node_modules/lit-element/lit-element.min.js";import{property as o}from"../../node_modules/@lit/reactive-element/decorators/property.min.js";import{state as s}from"../../node_modules/@lit/reactive-element/decorators/state.min.js";import{query as n}from"../../node_modules/@lit/reactive-element/decorators/query.min.js";import{queryAssignedElements as l}from"../../node_modules/@lit/reactive-element/decorators/query-assigned-elements.min.js";import{prefix as a,selectorTabbable as r}from"../../globals/settings.min.js";import c from"../../globals/decorators/host-listener.min.js";import d from"../../globals/mixins/host-listener.min.js";import{SIDE_PANEL_PLACEMENT as h,SIDE_PANEL_SIZE as p}from"./defs.min.js";import{carbonElement as u}from"../../globals/decorators/carbon-element.min.js";import _ from"../../packages/icons/lib/arrow--left/16.min.js";import v from"../../packages/icons/lib/close/20.min.js";import{moderate02 as m}from"../../packages/motion/es/index.min.js";import"../button/button.min.js";import"../button/button-set.min.js";import"../button/button-skeleton.min.js";import"../icon-button/icon-button.min.js";import"../layer/layer.min.js";import"../button/button-set-base.min.js";const b=Node.DOCUMENT_POSITION_PRECEDING|Node.DOCUMENT_POSITION_CONTAINS,g=Node.DOCUMENT_POSITION_FOLLOWING|Node.DOCUMENT_POSITION_CONTAINED_BY,$=`${a}--side-panel`,y=`${a}--action-set`;function f(t,e){for(let e=t.length-1;e>=0;--e){const i=t[e];if(i.focus(),i.ownerDocument.activeElement===i)return!0}return!1}let S=class extends(d(i)){constructor(){super(...arguments),this._hObserveResize=null,this._launcher=null,this._doAnimateTitle=!0,this._isOpen=!1,this._containerScrollTop=-16,this._hasSubtitle=!1,this._hasSlug=!1,this._hasActionToolbar=!1,this._actionsCount=0,this._slugCloseSize="sm",this._handleBlur=async({target:t,relatedTarget:e})=>{var i;const{open:o,_startSentinelNode:s,_endSentinelNode:n}=this,l=t!==this&&this.contains(t),a=e!==this&&(this.contains(e)||(null===(i=this.shadowRoot)||void 0===i?void 0:i.contains(e))&&e!==s&&e!==n),{selectorTabbable:r}=this.constructor;if(o&&e&&l&&!a){const i=t.compareDocumentPosition(e);e===s||i&b?(await this.constructor._delay(),f(this.querySelectorAll(r))||e===this||this.focus()):(e===n||i&g)&&(await this.constructor._delay(),f(this.querySelectorAll(r))||this.focus())}},this._handleKeydown=({key:t,target:e})=>{"Esc"!==t&&"Escape"!==t||this._handleUserInitiatedClose(e)},this._reducedMotion="undefined"!=typeof window&&(null===window||void 0===window?void 0:window.matchMedia)?window.matchMedia("(prefers-reduced-motion: reduce)"):{matches:!0},this._adjustPageContent=()=>{var t,e;if(this.selectorPageContent){const i=document.querySelector(this.selectorPageContent);if(i){const o={marginInlineStart:"",marginInlineEnd:"",inlineSize:"",transition:this._reducedMotion.matches?"none":`all ${m}`,transitionProperty:"margin-inline-start, margin-inline-end"};this.open&&(o.inlineSize="auto","left"===this.placement?o.marginInlineStart=`${null===(t=null==this?void 0:this._sidePanel)||void 0===t?void 0:t.offsetWidth}px`:o.marginInlineEnd=`${null===(e=null==this?void 0:this._sidePanel)||void 0===e?void 0:e.offsetWidth}px`),Object.keys(o).forEach((t=>{i.style[t]=o[t]}))}}},this._checkSetOpen=()=>{const{_sidePanel:t}=this;t&&this._isOpen?this._reducedMotion?this._isOpen=!1:t.addEventListener("transitionend",(()=>{this._isOpen=!1})):this._isOpen=this.open},this._checkUpdateIconButtonSizes=()=>{var t,e;const i=this.querySelector(`${a}-slug`),o=null===(t=null==this?void 0:this.shadowRoot)||void 0===t?void 0:t.querySelectorAll("#nav-back-button, #close-button");let s="sm";if(i||(null==o?void 0:o.length)){const t=null===(e=null==this?void 0:this.querySelectorAll)||void 0===e?void 0:e.call(this,`${a}-button[slot='actions']`);(null==t?void 0:t.length)&&/l/.test(this.size)&&(s="md")}i&&(null==i||i.setAttribute("size",s)),o&&[...o].forEach((t=>{t.setAttribute("size",s)}))},this._checkUpdateActionSizes=()=>{if(this._actions)for(let t=0;t<this._actions.length;t++)this._actions[t].setAttribute("size",this.condensedActions?"lg":"xl")},this._maxActions=3,this._checkSetDoAnimateTitle=()=>{var t,e,i;let o=!1;if(this._sidePanel&&this.open&&this.animateTitle&&(null===(t=null==this?void 0:this.title)||void 0===t?void 0:t.length)&&!this._reducedMotion.matches){const t=this._getScrollAnimationDistance();null===(i=null===(e=null==this?void 0:this._sidePanel)||void 0===e?void 0:e.style)||void 0===i||i.setProperty(`--${$}--scroll-animation-distance`,`${t}`);let s=this._animateScrollWrapper;if(s||!this.animateTitle||this._doAnimateTitle||(s=this._innerContent),s){const e=null===window||void 0===window?void 0:window.getComputedStyle(this._innerContent),i=e?parseFloat(null==e?void 0:e.paddingTop)+parseFloat(null==e?void 0:e.paddingBottom):0;o=(!!this.labelText||!!this._hasActionToolbar||this._hasSubtitle)&&s.scrollHeight-s.clientHeight>=t+i}}this._doAnimateTitle=o},this._resizeObserver=new ResizeObserver((()=>{this._sidePanel&&this._checkSetDoAnimateTitle()})),this._getScrollAnimationDistance=()=>{var t,e,i,o;return(null!==(e=null===(t=null==this?void 0:this._label)||void 0===t?void 0:t.offsetHeight)&&void 0!==e?e:0)+(null!==(o=null===(i=null==this?void 0:this._subtitle)||void 0===i?void 0:i.offsetHeight)&&void 0!==o?o:0)+(this._hasActionToolbar?this._title.offsetHeight-this._title.clientHeight:0)},this._scrollObserver=()=>{var t,e,i,o;const s=null!==(e=null===(t=this._animateScrollWrapper)||void 0===t?void 0:t.scrollTop)&&void 0!==e?e:0,n=this._getScrollAnimationDistance();null===(o=null===(i=null==this?void 0:this._sidePanel)||void 0===i?void 0:i.style)||void 0===o||o.setProperty(`--${$}--scroll-animation-progress`,""+Math.min(s,n)/n)},this._handleCurrentStepUpdate=()=>{var t;const e=null!==(t=this._animateScrollWrapper)&&void 0!==t?t:this._innerContent;e&&(e.scrollTop=0)},this.animateTitle=!0,this.closeIconDescription="Close",this.condensedActions=!1,this.includeOverlay=!1,this.navigationBackIconDescription="Back",this.open=!1,this.placement=h.RIGHT,this.preventCloseOnClickOutside=!1,this.selectorPageContent="",this.size=p.MEDIUM,this.slideIn=!1}_handleClickOnOverlay(t){this.preventCloseOnClickOutside||this._handleUserInitiatedClose(t.target)}_handleCloseClick(t){this._handleUserInitiatedClose(t.target)}_handleUserInitiatedClose(t){if(this.open){const e={bubbles:!0,cancelable:!0,composed:!0,detail:{triggeredBy:t}};this.dispatchEvent(new CustomEvent(this.constructor.eventBeforeClose,e))&&(this.open=!1,this.dispatchEvent(new CustomEvent(this.constructor.eventClose,e)))}}_handleNavigateBack(t){this.dispatchEvent(new CustomEvent(this.constructor.eventNavigateBack,{composed:!0,detail:{triggeredBy:t}}))}_handleSlugChange(t){this._checkUpdateIconButtonSizes();const e=t.target.assignedElements();this._hasSlug=e.length>0}_handleSubtitleChange(t){const e=t.target,i=null==e?void 0:e.assignedElements();this._hasSubtitle=i.length>0}_handleActionToolbarChange(t){const e=t.target,i=null==e?void 0:e.assignedElements();if(this._hasActionToolbar=i&&i.length>0,this._hasActionToolbar)for(const t of i)t.setAttribute("size","sm")}_handleActionsChange(t){var e;const i=t.target,o=null==i?void 0:i.assignedElements();this._checkUpdateIconButtonSizes();const s=null!==(e=null==o?void 0:o.length)&&void 0!==e?e:0;s>this._maxActions?(this._actionsCount=this._maxActions,"development"===production&&console.error(`Too many side-panel actions, max ${this._maxActions}.`)):this._actionsCount=s;for(let t=0;t<(null==o?void 0:o.length);t++)t+1>this._maxActions?(o[t].setAttribute("hidden","true"),o[t].setAttribute(`data-actions-limit-${this._maxActions}-exceeded`,`${o.length}`)):o[t].classList.add(`${y}__action-button`);this._checkUpdateActionSizes()}async connectObservers(){var t,e;await this.updateComplete,this._hObserveResize=(t=this._resizeObserver,(e=this._sidePanel)?(t.observe(e),{release:()=>(t.unobserve(e),null)}):null)}disconnectObservers(){this._hObserveResize&&(this._hObserveResize=this._hObserveResize.release())}connectedCallback(){super.connectedCallback(),this.disconnectObservers(),this.connectObservers()}disconnectedCallback(){super.disconnectedCallback(),this.disconnectObservers()}render(){const{closeIconDescription:t,condensedActions:i,currentStep:o,includeOverlay:s,labelText:n,navigationBackIconDescription:l,open:r,placement:c,size:d,slideIn:h,title:p}=this;if(!r&&!this._isOpen)return e``;const u=["","single","double","triple"][this._actionsCount],m=e`<div
      class=${`${$}__title`}
      ?no-label=${!!n}>
      <h2 class=${p?`${$}__title-text`:""} title=${p}>
        ${p}
      </h2>

      ${this._doAnimateTitle?e`<h2
            class=${`${$}__collapsed-title-text`}
            title=${p}
            aria-hidden="true">
            ${p}
          </h2>`:""}
    </div>`,b=this.title?` ${$}__header--has-title `:"",g=e`
      <div
        class=${`${$}__header${b}`}
        ?detail-step=${o>0}
        ?no-title-animation=${!this._doAnimateTitle}
        ?reduced-motion=${this._reducedMotion.matches}>
        <!-- render back button -->
        ${o>0?e`<cds-icon-button
              align="bottom-left"
              aria-label=${l}
              kind="ghost"
              size="sm"
              class=${`${a}--btn ${$}__navigation-back-button`}
              @click=${this._handleNavigateBack}>
              ${_({slot:"icon"})}
              <span slot="tooltip-content">
                ${l}
              </span>
            </cds-icon-button>`:""}

        <!-- render title label -->
        ${(null==p?void 0:p.length)&&(null==n?void 0:n.length)?e` <p class=${`${$}__label-text`}>${n}</p>`:""}

        <!-- title -->
        ${p?m:""}

        <!-- render slug and close button area -->
        <div class=${`${$}__slug-and-close`}>
          <slot name="slug" @slotchange=${this._handleSlugChange}></slot>
          <!-- {normalizedSlug} -->
          <cds-icon-button
            align="bottom-right"
            aria-label=${t}
            kind="ghost"
            size="sm"
            class=${`${$}__close-button`}
            @click=${this._handleCloseClick}>
            ${v({slot:"icon"})}
            <span slot="tooltip-content"> ${t} </span>
          </cds-icon-button>
        </div>

        <!-- render sub title -->
        <p
          class=${this._hasSubtitle?`${$}__subtitle-text`:""}
          ?hidden=${!this._hasSubtitle}
          ?no-title-animation=${!this._doAnimateTitle}
          ?no-action-toolbar=${!this._hasActionToolbar}
          ?no-title=${!p}>
          <slot
            name="subtitle"
            @slotchange=${this._handleSubtitleChange}></slot>
        </p>

        <div
          class=${this._hasActionToolbar?`${$}__action-toolbar`:""}
          ?hidden=${!this._hasActionToolbar}
          ?no-title-animation=${!this._doAnimateTitle}>
          <slot
            name="action-toolbar"
            @slotchange=${this._handleActionToolbarChange}></slot>
        </div>
      </div>
    `,y=e`<div
      class=${`${$}__inner-content`}
      ?scrolls=${!this._doAnimateTitle}>
      <cds-layer level="1">
        <slot></slot>
      </cds-layer>
    </div> `,f=this._doAnimateTitle?` ${$}--animated-title`:"";return e`
      <div
        class=${`${$}${f}`}
        part="dialog"
        role="complementary"
        placement="${c}"
        ?has-slug=${this._hasSlug}
        ?open=${this._isOpen}
        ?opening=${r&&!this._isOpen}
        ?closing=${!r&&this._isOpen}
        ?condensed-actions=${i}
        ?overlay=${s||h}
        ?slide-in=${h}
        size=${d}>
        <a
          id="start-sentinel"
          class="sentinel"
          hidden
          href="javascript:void 0"
          role="navigation"></a>

        ${this._doAnimateTitle?e`<div class=${`${$}__animated-scroll-wrapper`} scrolls>
              ${g} ${y}
            </div>`:e` ${g} ${y}`}

        <cds-button-set-base
          class=${`${$}__actions-container`}
          ?hidden=${0===this._actionsCount}
          ?condensed=${i}
          actions-multiple=${u}
          size=${d}>
          <slot name="actions" @slotchange=${this._handleActionsChange}></slot>
        </cds-button-set-base>

        <a
          id="end-sentinel"
          class="sentinel"
          hidden
          href="javascript:void 0"
          role="navigation"></a>
      </div>

      ${s?e`<div
            ?slide-in=${h}
            class=${`${$}__overlay`}
            ?open=${this.open}
            ?opening=${r&&!this._isOpen}
            ?closing=${!r&&this._isOpen}
            tabindex="-1"
            @click=${this._handleClickOnOverlay}></div>`:""}
    `}async updated(t){var e,i,o,s;if(t.has("condensedActions")&&this._checkUpdateActionSizes(),t.has("currentStep")&&this._handleCurrentStepUpdate(),t.has("_doAnimateTitle")&&(null===(e=null==this?void 0:this._animateScrollWrapper)||void 0===e||e.removeEventListener("scroll",this._scrollObserver),this._doAnimateTitle?null===(i=null==this?void 0:this._animateScrollWrapper)||void 0===i||i.addEventListener("scroll",this._scrollObserver):null===(s=null===(o=null==this?void 0:this._sidePanel)||void 0===o?void 0:o.style)||void 0===s||s.setProperty(`--${$}--scroll-animation-progress`,"0")),(t.has("_isOpen")||t.has("animateTitle"))&&this._checkSetDoAnimateTitle(),(t.has("slideIn")||t.has("open")||t.has("includeOverlay"))&&this._adjustPageContent(),t.has("open"))if(this._checkSetOpen(),this.disconnectObservers(),this.open){this.connectObservers(),this._launcher=this.ownerDocument.activeElement;const t=this.selectorInitialFocus&&this.querySelector(this.selectorInitialFocus);await this.constructor._delay(),t?t.focus():f(this.querySelectorAll(this.constructor.selectorTabbable))||this.focus()}else this._launcher&&"function"==typeof this._launcher.focus&&(this._launcher.focus(),this._launcher=null)}static _delay(t=0){return new Promise((e=>{setTimeout(e,t)}))}static get selectorTabbable(){return r}static get eventBeforeClose(){return`${a}-side-panel-beingclosed`}static get eventClose(){return`${a}-side-panel-closed`}static get eventNavigateBack(){return`${a}-side-panel-navigate-back`}};t([n("#start-sentinel")],S.prototype,"_startSentinelNode",void 0),t([n("#end-sentinel")],S.prototype,"_endSentinelNode",void 0),t([n(`.${$}`)],S.prototype,"_sidePanel",void 0),t([n(`.${$}__animated-scroll-wrapper`)],S.prototype,"_animateScrollWrapper",void 0),t([n(`.${$}__label-text`)],S.prototype,"_label",void 0),t([n(`.${$}__title-text`)],S.prototype,"_title",void 0),t([n(`.${$}__subtitle-text`)],S.prototype,"_subtitle",void 0),t([n(`.${$}__inner-content`)],S.prototype,"_innerContent",void 0),t([l({slot:"actions",selector:`${a}-button`})],S.prototype,"_actions",void 0),t([s()],S.prototype,"_doAnimateTitle",void 0),t([s()],S.prototype,"_isOpen",void 0),t([s()],S.prototype,"_containerScrollTop",void 0),t([s()],S.prototype,"_hasSubtitle",void 0),t([s()],S.prototype,"_hasSlug",void 0),t([s()],S.prototype,"_hasActionToolbar",void 0),t([s()],S.prototype,"_actionsCount",void 0),t([s()],S.prototype,"_slugCloseSize",void 0),t([c("shadowRoot:focusout")],S.prototype,"_handleBlur",void 0),t([c("document:keydown")],S.prototype,"_handleKeydown",void 0),t([o({reflect:!0,attribute:"animate-title",type:Boolean})],S.prototype,"animateTitle",void 0),t([o({reflect:!0,attribute:"close-icon-description"})],S.prototype,"closeIconDescription",void 0),t([o({type:Boolean,reflect:!0,attribute:"condensed-actions"})],S.prototype,"condensedActions",void 0),t([o({reflect:!0,attribute:"current-step",type:Number})],S.prototype,"currentStep",void 0),t([o({attribute:"include-overlay",type:Boolean,reflect:!0})],S.prototype,"includeOverlay",void 0),t([o({reflect:!0,attribute:"label-text"})],S.prototype,"labelText",void 0),t([o({reflect:!0,attribute:"navigation-back-icon-description"})],S.prototype,"navigationBackIconDescription",void 0),t([o({type:Boolean,reflect:!0})],S.prototype,"open",void 0),t([o({reflect:!0,type:String})],S.prototype,"placement",void 0),t([o({type:Boolean,attribute:"prevent-close-on-click-outside"})],S.prototype,"preventCloseOnClickOutside",void 0),t([o({reflect:!0,attribute:"selector-initial-focus",type:String})],S.prototype,"selectorInitialFocus",void 0),t([o({reflect:!0,attribute:"selector-page-content"})],S.prototype,"selectorPageContent",void 0),t([o({reflect:!0,type:String})],S.prototype,"size",void 0),t([o({attribute:"slide-in",type:Boolean,reflect:!0})],S.prototype,"slideIn",void 0),t([o({reflect:!1,type:String})],S.prototype,"title",void 0),S=t([u(`${a}-side-panel`)],S);export{h as SIDE_PANEL_PLACEMENT,p as SIDE_PANEL_SIZE};
