/**
 * Copyright IBM Corp. 2019, 2020
 *
 * This source code is licensed under the Apache-2.0 license found in the
 * LICENSE file in the root directory of this source tree.
 */
/**
 * @license
 * 
 * This bundle contains the following third-party dependencies:
 * 
 * Also refer to the following links for the license of other third-party dependencies:
 * 
 * https://www.npmjs.com/package/tslib
 * https://www.npmjs.com/package/lit
 * https://www.npmjs.com/package/@lit/context
 * https://www.npmjs.com/package/lodash-es
 * https://www.npmjs.com/package/@floating-ui/dom
 * https://www.npmjs.com/package/flatpickr
 * https://www.npmjs.com/package/lit-html
 * https://www.npmjs.com/package/lit-element
 * https://www.npmjs.com/package/@lit/reactive-element
 * https://www.npmjs.com/package/@floating-ui/core
 * https://www.npmjs.com/package/@floating-ui/utils
 */

import{__decorate as t}from"../../node_modules/tslib/tslib.es6.min.js";import{classMap as e}from"../../node_modules/lit-html/directives/class-map.min.js";import"../../node_modules/@lit/reactive-element/reactive-element.min.js";import{html as o}from"../../node_modules/lit-html/lit-html.min.js";import{LitElement as r}from"../../node_modules/lit-element/lit-element.min.js";import{property as s}from"../../node_modules/@lit/reactive-element/decorators/property.min.js";import{query as i}from"../../node_modules/@lit/reactive-element/decorators/query.min.js";import{carbonElement as n}from"../../globals/decorators/carbon-element.min.js";import{prefix as l}from"../../globals/settings.min.js";import a from"./popover.scss.min.js";import p from"../../globals/decorators/host-listener.min.js";import c from"../../globals/mixins/host-listener.min.js";import d from"../../globals/controllers/floating-controller.min.js";var h;let m=h=class extends(c(r)){_handleSlotChange({target:t}){if(this.tabTip){t.assignedNodes().filter((t=>t.nodeType!==Node.TEXT_NODE||t.textContent.trim()))[0].classList.add(`${l}--popover--tab-tip__button`)}this.requestUpdate()}_handleFocusOut(t){const e=t.relatedTarget;this.contains(e)||(this.open=!1)}_handleOutsideClick(t){const e=t.target;this.open&&e&&!this.contains(e)&&(this.open=!1)}constructor(){super(),this.popoverController=new d(this),this.align="",this.autoalign=!1,this.caret=!0,this.dropShadow=!0,this.highContrast=!1,this.open=!1,this.tabTip=!1,this._handleOutsideClick=this._handleOutsideClick.bind(this)}connectedCallback(){super.connectedCallback(),document.addEventListener("click",this._handleOutsideClick)}disconnectedCallback(){document.removeEventListener("click",this._handleOutsideClick)}updated(t){var e,o,r;const{selectorPopoverContent:s}=this.constructor;if(["open","align","autoalign","caret","dropShadow","tabTip"].forEach((e=>{if(t.has(e)){const{[e]:t}=this;this.querySelector(s)&&(this.querySelector(s)[e]=t)}})),this.autoalign&&this.open){const t=this._triggerSlotNode.assignedElements()[0],s=this._contentSlotNode.assignedElements()[0],i=null===(e=null==s?void 0:s.shadowRoot)||void 0===e?void 0:e.querySelector(h.selectorPopoverContentClass),n=null===(o=null==s?void 0:s.shadowRoot)||void 0===o?void 0:o.querySelector(h.selectorPopoverCaret);t&&i&&(null===(r=this.popoverController)||void 0===r||r.setPlacement({trigger:t,target:i,arrowElement:this.caret&&n?n:void 0,caret:this.caret,flipArguments:{fallbackAxisSideDirection:"start"},alignment:this.align,open:this.open}))}}render(){const{dropShadow:t,highContrast:r,open:s,tabTip:i,_handleSlotChange:n}=this;i&&(this.caret=!i),this.align=this.align?this.align:i?"bottom-left":"bottom";const a=e({[`${l}--popover-container`]:!0,[`${l}--popover--caret`]:this.caret,[`${l}--popover--drop-shadow`]:t,[`${l}--popover--high-contrast`]:r,[`${l}--popover--open`]:s,[`${l}--popover--${this.align}`]:!0,[`${l}--popover--tab-tip`]:i});return o`
    <span class="${a}" part="popover-container">
      <slot @slotchange="${n}"></slot>
      <slot name="content"><slot>
    </span>
    `}static get selectorPopoverContentClass(){return`.${l}--popover-content`}static get selectorPopoverCaret(){return`.${l}--popover-caret`}static get selectorPopoverContent(){return`${l}-popover-content`}};m.styles=a,t([i("slot")],m.prototype,"_triggerSlotNode",void 0),t([i('slot[name="content"]')],m.prototype,"_contentSlotNode",void 0),t([s({reflect:!0,type:String})],m.prototype,"align",void 0),t([s({type:Boolean,reflect:!0})],m.prototype,"autoalign",void 0),t([s({type:Boolean,reflect:!0})],m.prototype,"caret",void 0),t([s({type:Boolean,reflect:!0})],m.prototype,"dropShadow",void 0),t([s({type:Boolean,reflect:!0})],m.prototype,"highContrast",void 0),t([s({type:Boolean,reflect:!0})],m.prototype,"open",void 0),t([s({type:Boolean,reflect:!0})],m.prototype,"tabTip",void 0),t([p("focusout")],m.prototype,"_handleFocusOut",null),m=h=t([n(`${l}-popover`)],m);var v=m;export{v as default};
