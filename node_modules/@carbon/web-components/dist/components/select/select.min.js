/**
 * Copyright IBM Corp. 2019, 2020
 *
 * This source code is licensed under the Apache-2.0 license found in the
 * LICENSE file in the root directory of this source tree.
 */
/**
 * @license
 * 
 * This bundle contains the following third-party dependencies:
 * 
 * Also refer to the following links for the license of other third-party dependencies:
 * 
 * https://www.npmjs.com/package/tslib
 * https://www.npmjs.com/package/lit
 * https://www.npmjs.com/package/@lit/context
 * https://www.npmjs.com/package/lodash-es
 * https://www.npmjs.com/package/@floating-ui/dom
 * https://www.npmjs.com/package/flatpickr
 * https://www.npmjs.com/package/lit-html
 * https://www.npmjs.com/package/lit-element
 * https://www.npmjs.com/package/@lit/reactive-element
 * https://www.npmjs.com/package/@floating-ui/core
 * https://www.npmjs.com/package/@floating-ui/utils
 */

import{__decorate as e}from"../../node_modules/tslib/tslib.es6.min.js";import"../../node_modules/@lit/reactive-element/reactive-element.min.js";import{html as t}from"../../node_modules/lit-html/lit-html.min.js";import{LitElement as i}from"../../node_modules/lit-element/lit-element.min.js";import{property as l}from"../../node_modules/@lit/reactive-element/decorators/property.min.js";import{query as o}from"../../node_modules/@lit/reactive-element/decorators/query.min.js";import{queryAll as s}from"../../node_modules/@lit/reactive-element/decorators/query-all.min.js";import{classMap as a}from"../../node_modules/lit-html/directives/class-map.min.js";import r from"../../packages/icons/lib/chevron--down/16.min.js";import n from"../../packages/icons/lib/warning--filled/16.min.js";import d from"../../packages/icons/lib/warning--alt--filled/16.min.js";import{prefix as c}from"../../globals/settings.min.js";import{ifDefined as p}from"../../node_modules/lit-html/directives/if-defined.min.js";import u from"../../globals/mixins/form.min.js";import{filter as m}from"../../globals/internal/collection-helpers.min.js";import"../text-input/text-input.min.js";import h from"./select.scss.min.js";import v from"../../globals/directives/if-non-empty.min.js";import{carbonElement as b}from"../../globals/decorators/carbon-element.min.js";import{INPUT_SIZE as $}from"../text-input/defs.min.js";let _=class extends(u(i)){constructor(){super(...arguments),this._hasAILabel=!1,this._observerMutation=null,this._placeholderItemValue=`__${c}-select-placeholder_${Math.random().toString(36).slice(2)}`,this._handleMutation=()=>{this.requestUpdate()},this.autofocus=!1,this.disabled=!1,this.helperText="",this.hideLabel=!1,this.id="",this.invalid=!1,this.invalidText="",this.warn=!1,this.warnText="",this.labelText="",this.inline=!1,this.name="",this.pattern="",this.placeholder="",this.readonly=!1,this.required=!1,this.requiredValidityMessage="Please fill out this field.",this.size=$.MEDIUM,this.value=""}_handleInput({target:e}){const{value:t}=e;this.value=t;const{eventSelect:i}=this.constructor;this.dispatchEvent(new CustomEvent(i,{bubbles:!0,composed:!0,detail:{value:t}}))}_renderItems(e){const{selectorItem:i,selectorLeafItem:l}=this.constructor;return t`
      ${m(e.childNodes,(e=>e.nodeType===Node.ELEMENT_NODE&&e.matches(i))).map((e=>{const i=e.hasAttribute("disabled"),o=e.getAttribute("label"),s=e.hasAttribute("selected"),a=e.getAttribute("value"),{textContent:r}=e;return e.matches(l)?t`
              <option
                class="${c}--select-option"
                ?disabled="${i}"
                label="${v(o)}"
                ?selected="${s}"
                value="${p(a)}">
                ${r}
              </option>
            `:t`
              <optgroup
                class="${c}--select-optgroup"
                ?disabled="${i}"
                label="${p(o)}">
                ${this._renderItems(e)}
              </optgroup>
            `}))}
    `}_handleFormdata(e){const{formData:t}=e,{disabled:i,name:l,value:o}=this;i||t.append(l,o)}_handleAILabelSlotChange({target:e}){const t=e.assignedNodes().filter((e=>void 0!==e.matches&&(e.matches(this.constructor.aiLabelItem)||e.matches(this.constructor.slugItem))));this._hasAILabel=Boolean(t),this.setAttribute("slug",`${this._hasAILabel}`),t[0].setAttribute("size","mini"),this.requestUpdate()}get length(){return this._selectNode.length}get options(){return this._selectNode.options}get type(){return this._selectNode.type}get multiple(){return!1}get selectedIndex(){var e;return null===(e=this._selectNode)||void 0===e?void 0:e.selectedIndex}set selectedIndex(e){this._selectNode.selectedIndex=e,this.value=this._selectNode.value}connectedCallback(){super.connectedCallback(),this._observerMutation=new MutationObserver(this._handleMutation),this._observerMutation.observe(this,{attributes:!0,childList:!0,subtree:!0})}disconnectedCallback(){this._observerMutation&&(this._observerMutation.disconnect(),this._observerMutation=null),super.disconnectedCallback()}updated(e){var t,i,l,o,s,a,r,n,d,p;if(e.has("value")){const{value:e,_placeholderItemValue:o}=this,s=null===(l=null===(t=this._selectedOptionNodes)||void 0===t?void 0:t[(null===(i=this._selectedOptionNodes)||void 0===i?void 0:i.length)-1])||void 0===l?void 0:l.value;this._selectNode.value=e||(s||o)}const u=null===(o=this.shadowRoot)||void 0===o?void 0:o.querySelector("slot[name='ai-label']");u?((null===(s=u.assignedNodes())||void 0===s?void 0:s.length)&&(null===(a=this._inputNode)||void 0===a||a.classList.add(`${c}--select-input-has--ai-label`)),null==u||u.classList.toggle(`${c}--slug--revert`,null===(r=this.querySelector(`${c}-ai-label`))||void 0===r?void 0:r.hasAttribute("revert-active"))):null===(d=null===(n=this.shadowRoot)||void 0===n?void 0:n.querySelector("slot[name='slug']"))||void 0===d||d.classList.toggle(`${c}--slug--revert`,null===(p=this.querySelector(`${c}-slug`))||void 0===p?void 0:p.hasAttribute("revert-active"))}render(){const{disabled:e,helperText:i,hideLabel:l,inline:o,invalid:s,invalidText:u,labelText:m,placeholder:h,readonly:v,size:b,warn:$,warnText:_,value:g,_placeholderItemValue:y,_handleInput:f,_handleAILabelSlotChange:x}=this,I=a({[`${c}--select-input`]:!0,[`${c}--select-input--${b}`]:b}),j=a({[`${c}--label`]:!0,[`${c}--label--disabled`]:e}),w=a({[`${c}--form__helper-text`]:!0,[`${c}--form__helper-text--disabled`]:e}),N=i?t`
          <div class="${w}">
            <slot name="helper-text"> ${i} </slot>
          </div>
        `:null,L=s||$?t` <div class="${c}--form-requirement">
            ${s?u:_}
          </div>`:null,q=t`
      <select
        id="input"
        class="${I}"
        ?disabled="${e}"
        aria-readonly="${String(Boolean(v))}"
        aria-invalid="${String(Boolean(s))}"
        aria-describedby="${p(s?"invalid-text":void 0)}"
        @input="${f}">
        ${!h||g?void 0:t`
              <option
                disabled
                hidden
                class="${c}--select-option"
                value="${y}">
                ${h}
              </option>
            `}
        ${this._renderItems(this)}
      </select>
      ${r({class:`${c}--select__arrow`,"aria-hidden":!0})}
      <slot
        name="ai-label"
        style="--${c}-show-before: ${$||s?"block":"none"}"
        @slotchange=${x}></slot>
      <slot name="slug" @slotchange=${x}></slot>
      ${s?n({class:`${c}--select__invalid-icon`}):void 0}
      ${!s&&$?d({class:`${c}--select__invalid-icon ${c}--select__invalid-icon--warning`}):null}
    `;return t`
      ${l?null:t`<label class="${j}" for="input">
            <slot name="label-text"> ${m} </slot>
          </label>`}
      ${o?t`<div
            class="${c}--select-input--inline__wrapper"
            ?data-invalid="${s}">
            <div
              class="${c}--select-input__wrapper"
              ?data-invalid="${s}">
              ${q}
            </div>
          </div>`:t`<div
            class="${c}--select-input__wrapper"
            ?data-invalid="${s}">
            ${q}
          </div> `}
      ${L||N}
    `}static get selectorItem(){return`${c}-select-item-group,${c}-select-item`}static get selectorLeafItem(){return`${c}-select-item`}static get slugItem(){return`${c}-slug`}static get aiLabelItem(){return`${c}-ai-label`}static get eventSelect(){return`${c}-select-selected`}};_.shadowRootOptions=Object.assign(Object.assign({},i.shadowRootOptions),{delegatesFocus:!0}),_.styles=h,e([o("select")],_.prototype,"_selectNode",void 0),e([o("#input")],_.prototype,"_inputNode",void 0),e([s(`.${c}--select-option[selected]`)],_.prototype,"_selectedOptionNodes",void 0),e([l({type:Boolean})],_.prototype,"autofocus",void 0),e([l({type:Boolean,reflect:!0})],_.prototype,"disabled",void 0),e([l({attribute:"helper-text"})],_.prototype,"helperText",void 0),e([l({type:Boolean,attribute:"hide-label"})],_.prototype,"hideLabel",void 0),e([l()],_.prototype,"id",void 0),e([l({type:Boolean,reflect:!0})],_.prototype,"invalid",void 0),e([l({attribute:"invalid-text"})],_.prototype,"invalidText",void 0),e([l({type:Boolean,reflect:!0})],_.prototype,"warn",void 0),e([l({attribute:"warn-text"})],_.prototype,"warnText",void 0),e([l({attribute:"label-text"})],_.prototype,"labelText",void 0),e([l({type:Boolean,reflect:!0})],_.prototype,"inline",void 0),e([l({type:Boolean})],_.prototype,"multiple",null),e([l()],_.prototype,"name",void 0),e([l()],_.prototype,"pattern",void 0),e([l({reflect:!0})],_.prototype,"placeholder",void 0),e([l({type:Boolean,reflect:!0})],_.prototype,"readonly",void 0),e([l({type:Boolean,reflect:!0})],_.prototype,"required",void 0),e([l({attribute:"required-validity-message"})],_.prototype,"requiredValidityMessage",void 0),e([l({type:Number})],_.prototype,"selectedIndex",null),e([l({reflect:!0})],_.prototype,"size",void 0),e([l({reflect:!0})],_.prototype,"value",void 0),_=e([b(`${c}-select`)],_);
