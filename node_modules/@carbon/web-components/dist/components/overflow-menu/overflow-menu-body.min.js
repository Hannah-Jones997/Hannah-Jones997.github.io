/**
 * Copyright IBM Corp. 2019, 2020
 *
 * This source code is licensed under the Apache-2.0 license found in the
 * LICENSE file in the root directory of this source tree.
 */
/**
 * @license
 * 
 * This bundle contains the following third-party dependencies:
 * 
 * Also refer to the following links for the license of other third-party dependencies:
 * 
 * https://www.npmjs.com/package/tslib
 * https://www.npmjs.com/package/lit
 * https://www.npmjs.com/package/@lit/context
 * https://www.npmjs.com/package/lodash-es
 * https://www.npmjs.com/package/@floating-ui/dom
 * https://www.npmjs.com/package/flatpickr
 * https://www.npmjs.com/package/lit-html
 * https://www.npmjs.com/package/lit-element
 * https://www.npmjs.com/package/@lit/reactive-element
 * https://www.npmjs.com/package/@floating-ui/core
 * https://www.npmjs.com/package/@floating-ui/utils
 */

import{__decorate as e}from"../../node_modules/tslib/tslib.es6.min.js";import"../../node_modules/@lit/reactive-element/reactive-element.min.js";import{html as t}from"../../node_modules/lit-html/lit-html.min.js";import"../../node_modules/lit-element/lit-element.min.js";import{property as o}from"../../node_modules/@lit/reactive-element/decorators/property.min.js";import{prefix as i}from"../../globals/settings.min.js";import n from"../floating-menu/floating-menu.min.js";import{OVERFLOW_MENU_SIZE as s,NAVIGATION_DIRECTION as r}from"./defs.min.js";import l from"../../globals/decorators/host-listener.min.js";import{indexOf as m}from"../../globals/internal/collection-helpers.min.js";import{carbonElement as c}from"../../globals/decorators/carbon-element.min.js";import d from"./overflow-menu.scss.min.js";import{FLOATING_MENU_DIRECTION as a}from"../floating-menu/defs.min.js";var u;let p=u=class extends n{constructor(){super(...arguments),this.direction=a.BOTTOM,this.flipped=!1,this.open=!1,this.selected=null,this.size=s.MEDIUM,this._handleKeydown=async e=>{const{key:t}=e;if(this.open){if(this.contains(document.activeElement)&&(this.selected=document.activeElement),t in r)return e.preventDefault(),void this._navigate(r[t]);if("Escape"===t)return void(this.open=!1);const o=this.querySelectorAll(u.selectorItemEnabled);Array.from(o).some((e=>e.contains(document.activeElement)))&&(e.preventDefault(),this.open=!1,requestAnimationFrame((()=>{var e;const t=this.parent,o=(null===(e=null==t?void 0:t.shadowRoot)||void 0===e?void 0:e.querySelector(`button.${i}--overflow-menu`))||(null==t?void 0:t.querySelector(`button.${i}--overflow-menu`));o?o.focus():(console.warn("Could not find trigger button."),document.body.focus())})))}}}_getNextItem(e,t){const{selectorItemEnabled:o}=this.constructor,i=this.querySelectorAll(o),n=m(i,e),s=(r=n+t,l=i.length,r<0?l-1:r>=l?0:r);var r,l;return s===n?null:i[s]}_navigate(e){if(this.selected){const t=this._getNextItem(this.selected,e);null==t||t.focus()}}connectedCallback(){this.hasAttribute("role")||this.setAttribute("role","menu"),this.hasAttribute("tabindex")||this.setAttribute("tabindex","-1"),super.connectedCallback()}updated(e){if(e.has("size")){const{selectorMenuItem:e}=this.constructor;this.querySelectorAll(e).forEach((e=>{e.setAttribute("size",this.size)}))}super.updated(e)}render(){return t` <slot></slot> `}static get selectorMenuItem(){return`${i}-overflow-menu-item`}static get selectorItemEnabled(){return`${i}-overflow-menu-item:not([disabled])`}};p.styles=d,e([o()],p.prototype,"direction",void 0),e([o({type:Boolean,reflect:!0})],p.prototype,"flipped",void 0),e([o({type:Boolean,reflect:!0})],p.prototype,"open",void 0),e([o({reflect:!0})],p.prototype,"size",void 0),e([l("keydown")],p.prototype,"_handleKeydown",void 0),p=u=e([c(`${i}-overflow-menu-body`)],p);
