/**
 * Copyright IBM Corp. 2019, 2020
 *
 * This source code is licensed under the Apache-2.0 license found in the
 * LICENSE file in the root directory of this source tree.
 */
/**
 * @license
 * 
 * This bundle contains the following third-party dependencies:
 * 
 * Also refer to the following links for the license of other third-party dependencies:
 * 
 * https://www.npmjs.com/package/tslib
 * https://www.npmjs.com/package/lit
 * https://www.npmjs.com/package/@lit/context
 * https://www.npmjs.com/package/lodash-es
 * https://www.npmjs.com/package/@floating-ui/dom
 * https://www.npmjs.com/package/flatpickr
 * https://www.npmjs.com/package/lit-html
 * https://www.npmjs.com/package/lit-element
 * https://www.npmjs.com/package/@lit/reactive-element
 * https://www.npmjs.com/package/@floating-ui/core
 * https://www.npmjs.com/package/@floating-ui/utils
 */

import{__decorate as t}from"../../node_modules/tslib/tslib.es6.min.js";import"../../node_modules/@lit/reactive-element/reactive-element.min.js";import{html as e}from"../../node_modules/lit-html/lit-html.min.js";import"../../node_modules/lit-element/lit-element.min.js";import{property as o}from"../../node_modules/@lit/reactive-element/decorators/property.min.js";import{prefix as i}from"../../globals/settings.min.js";import s from"../../globals/decorators/host-listener.min.js";import l from"../../globals/mixins/focus.min.js";import n from"../../globals/mixins/host-listener.min.js";import{find as r}from"../../globals/internal/collection-helpers.min.js";import{OVERFLOW_MENU_SIZE as a}from"./defs.min.js";import d from"./overflow-menu.scss.min.js";import p from"../icon-button/icon-button.min.js";import{carbonElement as u}from"../../globals/decorators/carbon-element.min.js";let m=class extends(n(l(p))){constructor(){super(...arguments),this._menuBody=null,this._handleClickTrigger=async()=>{this._handleUserInitiatedToggle()},this._handleKeydownTrigger=async t=>{" "!==t.key&&"Enter"!==t.key||(this._handleUserInitiatedToggle(),t.preventDefault())},this.dataTable=!1,this.disabled=!1,this.flipped=!1,this.open=!1,this.index=1,this.size=a.MEDIUM,this.toolbarAction=!1,this.breadcrumb=!1}async _handleUserInitiatedToggle(){this.open=!this.open;const{index:t,open:e,updateComplete:o}=this;if(e){await o;const{_menuBody:e}=this,s=null==e?void 0:e.querySelector(`${i}-overflow-menu-item:nth-of-type(${t})`);null==s||s.focus()}}get triggerPosition(){return this.getBoundingClientRect()}connectedCallback(){this.hasAttribute("aria-haspopup")||this.setAttribute("aria-haspopup","true"),this.shadowRoot||this.attachShadow({mode:"open"}),super.connectedCallback()}updated(t){var e,o,s,l,n,a,d;const p=null===(o=null===(e=this.shadowRoot)||void 0===e?void 0:e.querySelector(`${i}-tooltip`))||void 0===o?void 0:o.querySelector("button");if(null==p||p.classList.add(`${i}--btn--icon-only`,`${i}--overflow-menu`),t.has("open")){const{open:t}=this;t&&!this._menuBody&&(this._menuBody=r(this.childNodes,(t=>t.constructor.FLOATING_MENU)));const{_menuBody:e}=this;if(e){e.setAttribute("breadcrumb",String(Boolean(this.breadcrumb))),e.open=t;const o=null===(s=this.querySelector("[slot=tooltip-content]"))||void 0===s?void 0:s.textContent;null==p||p.setAttribute("aria-expanded",String(Boolean(t))),null==p||p.setAttribute("aria-label",String(o))}}if(t.has("dataTable")){const t=null===(l=this.shadowRoot)||void 0===l?void 0:l.querySelector(`${i}-tooltip`);null==t||t.setAttribute("data-table","")}if(t.has("size")){const{size:t}=this,{_menuBody:e}=this;e&&(e.size=t),null==p||p.classList.forEach((t=>{t.startsWith(`${i}--overflow-menu--`)&&(null==p||p.classList.remove(t))})),null==p||p.classList.add(`${i}--overflow-menu--${this.size}`);const o=null===(n=this.shadowRoot)||void 0===n?void 0:n.querySelector(`${i}-tooltip`);null==o||o.setAttribute("size",this.size)}t.has("toolbarAction")&&this.toolbarAction&&(null===(d=null===(a=this.shadowRoot)||void 0===a?void 0:a.querySelector(`${i}-tooltip`))||void 0===d||d.setAttribute("toolbar-action","")),super.updated(t)}render(){return e`${super.render()} `}};m.styles=d,t([s("click")],m.prototype,"_handleClickTrigger",void 0),t([s("keydown")],m.prototype,"_handleKeydownTrigger",void 0),t([o({type:Boolean,reflect:!0,attribute:"data-table"})],m.prototype,"dataTable",void 0),t([o({type:Boolean,reflect:!0})],m.prototype,"disabled",void 0),t([o({type:Boolean,reflect:!0})],m.prototype,"flipped",void 0),t([o({type:Boolean,reflect:!0})],m.prototype,"open",void 0),t([o()],m.prototype,"index",void 0),t([o({reflect:!0})],m.prototype,"size",void 0),t([o({type:Boolean,attribute:"toolbar-action",reflect:!0})],m.prototype,"toolbarAction",void 0),t([o({type:Boolean,reflect:!0})],m.prototype,"breadcrumb",void 0),m=t([u(`${i}-overflow-menu`)],m);export{a as OVERFLOW_MENU_SIZE};
