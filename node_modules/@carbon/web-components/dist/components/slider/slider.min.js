/**
 * Copyright IBM Corp. 2019, 2020
 *
 * This source code is licensed under the Apache-2.0 license found in the
 * LICENSE file in the root directory of this source tree.
 */
/**
 * @license
 * 
 * This bundle contains the following third-party dependencies:
 * 
 * Also refer to the following links for the license of other third-party dependencies:
 * 
 * https://www.npmjs.com/package/tslib
 * https://www.npmjs.com/package/lit
 * https://www.npmjs.com/package/@lit/context
 * https://www.npmjs.com/package/lodash-es
 * https://www.npmjs.com/package/@floating-ui/dom
 * https://www.npmjs.com/package/flatpickr
 * https://www.npmjs.com/package/lit-html
 * https://www.npmjs.com/package/lit-element
 * https://www.npmjs.com/package/@lit/reactive-element
 * https://www.npmjs.com/package/@floating-ui/core
 * https://www.npmjs.com/package/@floating-ui/utils
 */

import{__decorate as t}from"../../node_modules/tslib/tslib.es6.min.js";import"../../node_modules/@lit/reactive-element/reactive-element.min.js";import{html as e}from"../../node_modules/lit-html/lit-html.min.js";import{LitElement as i}from"../../node_modules/lit-element/lit-element.min.js";import{property as a}from"../../node_modules/@lit/reactive-element/decorators/property.min.js";import{query as s}from"../../node_modules/@lit/reactive-element/decorators/query.min.js";import{classMap as l}from"../../node_modules/lit-html/directives/class-map.min.js";import r from"../../node_modules/lodash-es/throttle.min.js";import{prefix as n}from"../../globals/settings.min.js";import o from"../../globals/mixins/focus.min.js";import d from"../../globals/mixins/form.min.js";import h from"../../globals/mixins/host-listener.min.js";import p from"../../globals/decorators/host-listener.min.js";import u from"./slider.scss.min.js";import{carbonElement as m}from"../../globals/decorators/carbon-element.min.js";const v={Left:-1,ArrowLeft:-1,Up:-1,ArrowUp:-1,Right:1,ArrowRight:1,Down:1,ArrowDown:1};let c=class extends(h(d(o(i)))){constructor(){super(...arguments),this._cachedRateUpper=1,this._cachedRate=0,this.dragCooldownTimeout=null,this.dragCoolDown=!1,this._max="100",this._min="0",this._step="1",this._stepMultiplier="4",this._throttledHandlePointermoveImpl=null,this._dragging=!1,this._draggingUpper=!1,this.onDrag=r(this._startDrag,16,{leading:!0,trailing:!1}),this._handlePointermove=t=>{const{disabled:e,_dragging:i,_draggingUpper:a}=this;e||!i&&!a||this._throttledHandlePointermoveImpl(t)},this._endDrag=()=>{this._dragging||this._draggingUpper?this.dragCoolDown=!0:this.dragCoolDown=!1,this._dragging?(this.dispatchEvent(new CustomEvent(this.constructor.eventChange,{bubbles:!0,composed:!0,detail:{value:this.value}})),this._dragging=!1,this._thumbNode.style.touchAction=""):this._draggingUpper&&(this.dispatchEvent(new CustomEvent(this.constructor.eventChange,{bubbles:!0,composed:!0,detail:{value:this.unstable_valueUpper}})),this._draggingUpper=!1,this._thumbNodeUpper.style.touchAction=""),(this._dragging||this._draggingUpper)&&(this.dragCooldownTimeout=window.setTimeout((()=>{this.dragCoolDown=!1}),100))},this._handleChangeInput=t=>{var e;const i=t.target,a=null===(e=i.shadowRoot)||void 0===e?void 0:e.querySelector("input");this.isValid="CDS-SLIDER-INPUT"===i.tagName?this._getInputValidity(i):this.isValid,this.warn=this._getInputWarnigState(a);const s=t.target.id,{detail:l}=t,{intermediate:r,value:n}=l;this.warnText=r?`The inputted value ${r} was corrected to the nearest allowed digit`:"",r!==n&&("upper"===s?this.unstable_valueUpper=n:this.value=n);const o="upper"===s?this.unstable_valueUpper:this.value;""!==o&&this.dispatchEvent(new CustomEvent(this.constructor.eventChange,{bubbles:!0,composed:!0,detail:{value:o,intermediate:r}}))},this.disabled=!1,this.required=!1,this.readonly=!1,this.labelText="",this.maxLabel="",this.minLabel="",this.hideLabel=!1,this.formatMaxText=(t,e)=>`${t}${e}`,this.formatMinText=(t,e)=>`${t}${e}`,this.invalid=!1,this.invalidText="",this.warn=!1,this.warnText="",this.hideTextInput=!1}get _rate(){const{max:t,min:e,value:i}=this;if(i){const a=(Math.min(Number(t),Math.max(Number(e),i))-Number(e))/(Number(t)-Number(e));return this._cachedRate=a,a}return this._cachedRate}set _rate(t){const{max:e,min:i,step:a}=this;this.value=Number(i)+Math.round((Number(e)-Number(i))*Math.min(1,Math.max(0,t))/Number(a))*Number(a)}get _rateUpper(){const{max:t,min:e,unstable_valueUpper:i}=this;if(i){const a=(Math.min(Number(t),Math.max(Number(e),i))-Number(e))/(Number(t)-Number(e));return this._cachedRateUpper=a,a}return this._cachedRateUpper}set _rateUpper(t){const{max:e,min:i,step:a}=this;this.unstable_valueUpper=Number(i)+Math.round((Number(e)-Number(i))*Math.min(1,Math.max(0,t))/Number(a))*Number(a)}_handleClickLabel(){var t;null===(t=this._thumbNode)||void 0===t||t.focus()}_handleFormdata(t){const{formData:e}=t,{disabled:i,name:a,value:s}=this;i||e.append(a,String(s))}_handleKeydown(t){const e=t.target.id,{key:i,shiftKey:a}=t;if(!this.disabled&&!this.readonly&&i in v){const{max:t,min:s,step:l,stepMultiplier:r,value:n,unstable_valueUpper:o}=this,d=Number(t),h=Number(s),p=Number(l),u=Number(r),m=(a?(d-h)/u:p)*v[i];if("thumb-upper"==e){const t=(o+m)/p,e=Math.min(d,Math.max(h,(m>=0?Math.floor(t):Math.ceil(t))*p));e>=this.value&&(this.unstable_valueUpper=e),this.dispatchEvent(new CustomEvent(this.constructor.eventChange,{bubbles:!0,composed:!0,detail:{value:this.unstable_valueUpper,intermediate:!1}}))}else{const t=(n+m)/p,e=Math.min(d,Math.max(h,(m>=0?Math.floor(t):Math.ceil(t))*p));(!this.unstable_valueUpper||e<=this.unstable_valueUpper)&&(this.value=e),this.dispatchEvent(new CustomEvent(this.constructor.eventChange,{bubbles:!0,composed:!0,detail:{value:this.value,intermediate:!1}}))}}}_startDrag(t){if(!this.readonly&&!this.disabled){let e=t.target.id;if(!e){const i=t.target.nodeName;"path"!=i&&"svg"!=i||(e=t.target.parentElement.closest(".cds--slider__thumb-wrapper").id)}"thumb"===e?(this._dragging=!0,this._thumbNode.style.touchAction="none"):(this._draggingUpper=!0,this._thumbNodeUpper.style.touchAction="none")}}_handleClick(t){let e=t.target.id;if(!e){const i=t.target.nodeName;"path"!=i&&"svg"!=i||(e=t.target.parentElement.closest(".cds--slider__thumb-wrapper").id)}if(!this.disabled&&!this.readonly){const{_trackNode:i}=this,a="rtl"===i.ownerDocument.defaultView.getComputedStyle(i).getPropertyValue("direction"),s=t.clientX,{left:l,width:r}=i.getBoundingClientRect();if("thumb-upper"===e)this._rateUpper=(a?l+r-s:s-l)/r,this.dispatchEvent(new CustomEvent(this.constructor.eventChange,{bubbles:!0,composed:!0,detail:{value:this.unstable_valueUpper}}));else if(this.unstable_valueUpper){if(!this.dragCoolDown){const t=(a?l+r-s:s-l)/r*100,e=t>this.value?t-this.value:this.value-t,i=t>this.unstable_valueUpper?t-this.unstable_valueUpper:this.unstable_valueUpper-t;e>i?this._rateUpper=t/100:e<i?this._rate=t/100:this._dragging||this._draggingUpper||e!==i||(Math.round(t)>this.unstable_valueUpper?this._rateUpper=t/100:this._rate=t/100),this.dispatchEvent(new CustomEvent(this.constructor.eventChange,{bubbles:!0,composed:!0,detail:{value:this.value}}))}}else this._rate=(a?l+r-s:s-l)/r,this.dispatchEvent(new CustomEvent(this.constructor.eventChange,{bubbles:!0,composed:!0,detail:{value:this.value}}))}}_handlePointermoveImpl(t){const{disabled:e,_dragging:i,_trackNode:a,_draggingUpper:s}=this;if(!e){const e="rtl"===a.ownerDocument.defaultView.getComputedStyle(a).getPropertyValue("direction"),l=t.clientX,{left:r,width:n}=this._trackNode.getBoundingClientRect();if(i){const t=(e?r+n-l:l-r)/n;(!this.unstable_valueUpper||100*t<=this.unstable_valueUpper)&&(this._rate=t,this.dispatchEvent(new CustomEvent(this.constructor.eventChange,{bubbles:!0,composed:!0,detail:{value:this.value,intermediate:!0}})))}else if(s){const t=(e?r+n-l:l-r)/n;100*t>=this.value&&(this._rateUpper=t,this.dispatchEvent(new CustomEvent(this.constructor.eventChange,{bubbles:!0,composed:!0,detail:{value:this.unstable_valueUpper,intermediate:!0}})))}}}get max(){return this._max.toString()}set max(t){const{max:e}=this;this._max=t,this.requestUpdate("max",e)}get min(){return this._min.toString()}set min(t){const{min:e}=this;this._min=t,this.requestUpdate("min",e)}get step(){return this._step.toString()}set step(t){const{step:e}=this;this._step=t,this.requestUpdate("step",e)}get stepMultiplier(){return this._stepMultiplier.toString()}set stepMultiplier(t){const{stepMultiplier:e}=this;this._stepMultiplier=t,this.requestUpdate("stepMultiplier",e)}_getInputValidity(t){var e;const i=null===(e=null==t?void 0:t.shadowRoot)||void 0===e?void 0:e.querySelector("input");return!this.invalid&&(!(null==t?void 0:t.invalid)&&!((null==i?void 0:i.valueAsNumber)>Number(this.max)||(null==i?void 0:i.valueAsNumber)<Number(this.min)))}_getInputWarnigState(t){return(null==t?void 0:t.valueAsNumber)>Number(t.max)||(null==t?void 0:t.valueAsNumber)<Number(t.min)}connectedCallback(){super.connectedCallback(),this._throttledHandlePointermoveImpl||(this._throttledHandlePointermoveImpl=r(this._handlePointermoveImpl,10))}disconnectedCallback(){this._throttledHandlePointermoveImpl&&(this._throttledHandlePointermoveImpl.cancel(),this._throttledHandlePointermoveImpl=null),clearTimeout(this.dragCooldownTimeout),super.disconnectedCallback()}updated(){var t;const e=null===(t=null==this?void 0:this.shadowRoot)||void 0===t?void 0:t.querySelector(`.${n}--slider__filled-track`);e&&(this.unstable_valueUpper||this.unstable_valueUpper,e.style.transform=this.unstable_valueUpper?`translate(${100*this._rate}%, -50%) scaleX(${this._rateUpper-this._rate})`:`translate(0%, -50%) scaleX(${this._rate})`)}shouldUpdate(t){return this.querySelectorAll(this.constructor.selectorInput).forEach(((e,i)=>{t.has("disabled")&&(e&&(e.disabled=this.disabled),this.disabled&&(this._dragging=!1)),t.has("readonly")&&(e&&(e.readonly=this.readonly),this.readonly&&(this._dragging=!1)),t.has("invalid")&&(e.invalid=this.invalid),t.has("hideTextInput")&&(e.hideTextInput=this.hideTextInput),e&&((this.unstable_valueUpper||""===this.unstable_valueUpper)&&i>0?["max","min","step","unstable_valueUpper"].forEach((t=>{"unstable_valueUpper"===t?e.value=this.unstable_valueUpper:e[t]="min"===t?this.value:this[t]})):["max","min","step","value"].forEach((t=>{this.unstable_valueUpper&&"max"===t?e[t]=this.unstable_valueUpper:e[t]=this[t]})),(t.has("value")||t.has("invalid")||t.has("warn")||t.has("readonly"))&&(this.isValid=this._getInputValidity(e),this.readonly||this.isValid?e.invalid=!1:e.invalid=!0))})),!0}render(){const{disabled:t,formatMaxText:i,formatMinText:a,labelText:s,hideLabel:r,max:o,min:d,maxLabel:h,minLabel:p,readonly:u,invalidText:m,isValid:v,warn:c,warnText:b,value:_,unstable_valueUpper:g,_rate:w,_rateUpper:y,_handleClickLabel:$,_handleKeydown:f,_handleClick:x,onDrag:U,_endDrag:M}=this,N=l({[`${n}--label`]:!0,[`${n}--visually-hidden`]:r,[`${n}--label--disabled`]:t}),C=l({[`${n}--slider`]:!0,[`${n}--slider--disabled`]:t,[`${n}--slider--readonly`]:u}),T=l({[`${n}--icon-tooltip`]:g||""===g,[`${n}--slider__thumb-wrapper`]:g||""===g,[`${n}--slider__thumb-wrapper--lower`]:g||""===g,[`${n}--slider__thumb`]:!(g||""===g),[`${n}--slider__thumb-disabled`]:t}),E=l({[`${n}--icon-tooltip`]:!0,[`${n}--slider__thumb-wrapper`]:!0,[`${n}--slider__thumb-wrapper--upper`]:!0,[`${n}--slider__thumb-disabled`]:t});return e`
      <label class="${N}" @click="${$}">
        <slot name="label-text">${s}</slot>
      </label>
      <div class="${n}--slider-container">
        ${g||""===g?e` <slot name="lower-input"></slot>`:""}
        <span class="${n}--slider__range-label">
          <slot name="min-text">${a(d,p)}</slot>
        </span>
        <div
          @keydown="${f}"
          @click="${x}"
          @pointerup="${M}"
          @pointerleave="${M}"
          class="${C}"
          tabindex="-1"
          role="presentation">
          <div
            id="thumb"
            class="${T}"
            role="slider"
            tabindex="${u?-1:0}"
            aria-valuemax="${o}"
            aria-valuemin="${d}"
            aria-valuenow="${_}"
            style="left: ${100*w}%"
            @pointerdown="${U}">
            ${!g&&""!==g||u?"":e`
                  <div class="${n}--slider__thumb--lower">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 16 24"
                      class="${n}--slider__thumb-icon ${n}--slider__thumb-icon--lower">
                      <path
                        d="M15.08 6.46H16v11.08h-.92zM4.46 17.54c-.25 0-.46-.21-.46-.46V6.92a.465.465 0 0 1 .69-.4l8.77 5.08a.46.46 0 0 1 0 .8l-8.77 5.08c-.07.04-.15.06-.23.06Z"></path>
                      <path fill="none" d="M-4 0h24v24H-4z"></path>
                    </svg>
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 16 24"
                      class="${n}--slider__thumb-icon ${n}--slider__thumb-icon--lower cds--slider__thumb-icon--focus">
                      <path
                        d="M15.08 6.46H16v11.08h-.92zM4.46 17.54c-.25 0-.46-.21-.46-.46V6.92a.465.465 0 0 1 .69-.4l8.77 5.08a.46.46 0 0 1 0 .8l-8.77 5.08c-.07.04-.15.06-.23.06Z"></path>
                      <path fill="none" d="M-4 0h24v24H-4z"></path>
                      <path d="M15.08 0H16v6.46h-.92z"></path>
                      <path d="M0 0h.92v24H0zM15.08 0H16v24h-.92z"></path>
                      <path d="M0 .92V0h16v.92zM0 24v-.92h16V24z"></path>
                    </svg>
                  </div>
                `}
          </div>
          ${!g&&""!==g||u?e``:e`
                <div
                  id="thumb-upper"
                  class="${E}"
                  role="slider"
                  tabindex="${u?-1:0}"
                  aria-valuemax="${o}"
                  aria-valuemin="${d}"
                  aria-valuenow="${g}"
                  style="left: ${100*y}%"
                  @pointerdown="${U}">
                  <div class="${n}--slider__thumb--upper">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 16 24"
                      class="${n}--slider__thumb-icon ${n}--slider__thumb-icon--upper">
                      <path
                        d="M0 6.46h.92v11.08H0zM11.54 6.46c.25 0 .46.21.46.46v10.15a.465.465 0 0 1-.69.4L2.54 12.4a.46.46 0 0 1 0-.8l8.77-5.08c.07-.04.15-.06.23-.06Z"></path>
                      <path fill="none" d="M-4 0h24v24H-4z"></path>
                    </svg>
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 16 24"
                      class="${n}--slider__thumb-icon ${n}--slider__thumb-icon--upper cds--slider__thumb-icon--focus">
                      <path
                        d="M0 6.46h.92v11.08H0zM11.54 6.46c.25 0 .46.21.46.46v10.15a.465.465 0 0 1-.69.4L2.54 12.4a.46.46 0 0 1 0-.8l8.77-5.08c.07-.04.15-.06.23-.06Z"></path>
                      <path fill="none" d="M-4 0h24v24H-4z"></path>
                      <path d="M.92 24H0v-6.46h.92z"></path>
                      <path d="M16 24h-.92V0H16zM.92 24H0V0h.92z"></path>
                      <path d="M16 23.08V24H0v-.92zM16 0v.92H0V0z"></path>
                    </svg>
                  </div>
                </div>
              `}
          <div id="track" class="${n}--slider__track"></div>
          ${g||""===g?e` <div class="${n}--slider__filled-track"></div> `:e` <div class="${n}-ce--slider__filled-track-container">
                <div class="${n}--slider__filled-track"></div>
              </div>`}
        </div>
        <span class="${n}--slider__range-label">
          <slot name="max-text">${i(o,h)}</slot>
        </span>
        <slot></slot>
      </div>

      ${u||v?null:e`
            <div
              class="${n}--slider__validation-msg ${n}--slider__validation-msg--invalid ${n}--form-requirement">
              ${m}
            </div>
          `}
      ${!u&&c&&v?e`<div
            class="${n}--slider__validation-msg ${n}--form-requirement">
            ${b}
          </div>`:null}
    `}static get selectorInput(){return`${n}-slider-input`}static get eventChange(){return`${n}-slider-changed`}static get eventChangeInput(){return`${n}-slider-input-changed`}};c.shadowRootOptions=Object.assign(Object.assign({},i.shadowRootOptions),{delegatesFocus:!0}),c.styles=u,t([a({type:Number,attribute:"value-upper"})],c.prototype,"unstable_valueUpper",void 0),t([s("#thumb")],c.prototype,"_thumbNode",void 0),t([s("#thumb-upper")],c.prototype,"_thumbNodeUpper",void 0),t([s("#track")],c.prototype,"_trackNode",void 0),t([p("document:pointermove")],c.prototype,"_handlePointermove",void 0),t([p("eventChangeInput")],c.prototype,"_handleChangeInput",void 0),t([a({type:Boolean,reflect:!0})],c.prototype,"disabled",void 0),t([a({type:Boolean,reflect:!0})],c.prototype,"required",void 0),t([a({type:Boolean,reflect:!0})],c.prototype,"readonly",void 0),t([a({attribute:"label-text"})],c.prototype,"labelText",void 0),t([a({attribute:"max-label",reflect:!0})],c.prototype,"maxLabel",void 0),t([a({attribute:"min-label",reflect:!0})],c.prototype,"minLabel",void 0),t([a({attribute:"hide-label",type:Boolean,reflect:!0})],c.prototype,"hideLabel",void 0),t([a({attribute:!1})],c.prototype,"formatMaxText",void 0),t([a({attribute:!1})],c.prototype,"formatMinText",void 0),t([a({type:Number,reflect:!0})],c.prototype,"max",null),t([a({type:Number,reflect:!0})],c.prototype,"min",null),t([a()],c.prototype,"name",void 0),t([a({type:Boolean,reflect:!0})],c.prototype,"invalid",void 0),t([a({attribute:"invalid-text"})],c.prototype,"invalidText",void 0),t([a({type:Boolean,reflect:!0})],c.prototype,"warn",void 0),t([a({attribute:"warn-text"})],c.prototype,"warnText",void 0),t([a({type:Boolean,attribute:"hide-text-input",reflect:!0})],c.prototype,"hideTextInput",void 0),t([a({type:Number,reflect:!0})],c.prototype,"step",null),t([a({type:Number,reflect:!0,attribute:"step-multiplier"})],c.prototype,"stepMultiplier",null),t([a({type:Number})],c.prototype,"value",void 0),t([a({type:Boolean})],c.prototype,"isValid",void 0),c=t([m(`${n}-slider`)],c);
